import{c as he,u as K,j as e,C as me,S as Se,a as be,b as we}from"./fiber-D9zMpAwi.js";import{r as p,R as V}from"./react-F9Y4d3HK.js";import{c as x,E as $,l as Me,D as re,i as ke,m as ee}from"./three-BnXuNuvj.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();const q={yellow:{health:1,maxHealth:1,speed:2.5,detectionRange:8,color:"#FFD700",behavior:"flee"},blue:{health:1,maxHealth:1,speed:4.5,detectionRange:10,color:"#4169E1",behavior:"zigzag"},red:{health:2,maxHealth:2,speed:3.5,detectionRange:12,color:"#DC143C",behavior:"attack"},green:{health:2,maxHealth:2,speed:2,detectionRange:6,color:"#228B22",behavior:"hide"},black:{health:4,maxHealth:4,speed:4,detectionRange:15,color:"#2F2F2F",behavior:"elite"}},ve=[{type:"net",name:"ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ¼ãƒãƒƒãƒˆ",description:"çŒ¿ã‚’æ•ç²ã™ã‚‹ç¶²ã€‚æ¥è¿‘ã—ã¦ä½¿ç”¨ã€‚",cooldown:.5,currentCooldown:0,key:"1"},{type:"rod",name:"ã‚¹ã‚¿ãƒ³ãƒ­ãƒƒãƒ‰",description:"è¿‘è·é›¢æ”»æ’ƒã€‚çŒ¿ã‚’æ°—çµ¶ã•ã›ã‚‹ã€‚",cooldown:.8,currentCooldown:0,key:"2"},{type:"booster",name:"ãƒ–ãƒ¼ã‚¹ã‚¿ãƒ¼",description:"é«˜é€Ÿãƒ€ãƒƒã‚·ãƒ¥ç§»å‹•ã€‚",cooldown:3,currentCooldown:0,key:"3"},{type:"hover",name:"ãƒ›ãƒãƒ¼ãƒ‰ãƒ­ãƒ¼ãƒ³",description:"ç©ºä¸­æµ®éŠãƒ»æ»‘ç©ºã€‚",cooldown:5,currentCooldown:0,key:"4"},{type:"radar",name:"ãƒ¬ãƒ¼ãƒ€ãƒ¼ã‚¹ã‚­ãƒ£ãƒŠãƒ¼",description:"éš ã‚ŒãŸçŒ¿ã‚’æ¢çŸ¥ã€‚",cooldown:10,currentCooldown:0,key:"5"}],Ae=[{id:1,name:"ã‚¸ãƒ£ãƒ³ã‚°ãƒ«ã‚¨ãƒªã‚¢",theme:"jungle",monkeyCount:15,bossName:"ã‚¸ãƒ£ãƒ³ã‚°ãƒ«ã‚­ãƒ³ã‚°",unlocked:!0,cleared:!1,bestTime:null,bestRank:null},{id:2,name:"ã‚¢ã‚¤ã‚¹ãƒã‚¦ãƒ³ãƒ†ãƒ³",theme:"ice",monkeyCount:18,bossName:"ãƒ•ãƒ­ã‚¹ãƒˆãƒªãƒ¼ãƒ€ãƒ¼",unlocked:!1,cleared:!1,bestTime:null,bestRank:null},{id:3,name:"éºè·¡ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³",theme:"ruins",monkeyCount:20,bossName:"ãƒ†ãƒ³ãƒ—ãƒ«ã‚¬ãƒ¼ãƒ‡ã‚£ã‚¢ãƒ³",unlocked:!1,cleared:!1,bestTime:null,bestRank:null},{id:4,name:"ãƒ¡ã‚«ãƒ‹ã‚«ãƒ«ã‚·ãƒ†ã‚£",theme:"mechanical",monkeyCount:25,bossName:"ã‚µã‚¤ãƒãƒ¼ã‚¨ã‚¤ãƒ—",unlocked:!1,cleared:!1,bestTime:null,bestRank:null},{id:5,name:"ãƒœãƒ«ã‚±ãƒ¼ãƒãƒ™ãƒ¼ã‚¹",theme:"volcano",monkeyCount:30,bossName:"ãƒ¡ã‚¬ã‚¹ãƒšã‚¯ã‚¿ãƒ¼",unlocked:!1,cleared:!1,bestTime:null,bestRank:null}],P={PLAYER:{MOVE_SPEED:8,DASH_SPEED:16,JUMP_FORCE:12,GRAVITY:-25,MAX_HEALTH:100,DASH_DURATION:.3,DASH_COOLDOWN:1.5,CAPTURE_RANGE:4.5,ATTACK_RANGE:4,ATTACK_DAMAGE:1},CAMERA:{DISTANCE:10,HEIGHT_OFFSET:3,LERP_SPEED:8,MOUSE_SENSITIVITY:.002,MIN_PITCH:-Math.PI/4,MAX_PITCH:Math.PI/3},MONKEY:{ALERT_DECAY_RATE:.5,STUN_DURATION:3},STAGE:{BOUNDARY:50}},R={PLAYER:{BODY:"#4a90d9",SKIN:"#ffcc99",HAIR:"#4a3728"},MONKEY:{HELMET:"#808080"},STAGE:{JUNGLE:{GROUND:"#3d5c3d",SKY:"#87CEEB",FOG:"#90EE90"},ICE:{GROUND:"#E0FFFF",SKY:"#B0E0E6",FOG:"#F0F8FF"},RUINS:{GROUND:"#8B7355",SKY:"#DEB887",FOG:"#D2B48C"},MECHANICAL:{GROUND:"#2F4F4F",SKY:"#1a1a2e",FOG:"#363636"},VOLCANO:{GROUND:"#4a2020",SKY:"#2d1b1b",FOG:"#3d2020"}}},O={FORWARD:["w","W","ArrowUp"],BACKWARD:["s","S","ArrowDown"],LEFT:["a","A","ArrowLeft"],RIGHT:["d","D","ArrowRight"],JUMP:[" "],DASH:["Shift"],TOOL_1:["1"],TOOL_2:["2"],TOOL_3:["3"],TOOL_4:["4"],TOOL_5:["5"],PAUSE:["Escape","p","P"]},j=(s,n)=>Math.random()*(n-s)+s,Q=(s,n)=>s.distanceTo(n),ne=(s,n)=>new x().subVectors(n,s).normalize(),xe=s=>{const n=Math.floor(s/60),t=Math.floor(s%60),r=Math.floor(s%1*100);return`${n.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}.${r.toString().padStart(2,"0")}`},G=()=>`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,Te=(s,n)=>{try{localStorage.setItem(s,JSON.stringify(n))}catch(t){console.error("Failed to save to localStorage:",t)}},Ie=(s,n)=>{try{const t=localStorage.getItem(s);return t?JSON.parse(t):n}catch(t){return console.error("Failed to load from localStorage:",t),n}},Ee=s=>{for(;s>Math.PI;)s-=Math.PI*2;for(;s<-Math.PI;)s+=Math.PI*2;return s},le="monkey-catcher-save",ce=()=>({position:new x(0,1,0),rotation:new $(0,0,0),velocity:new x(0,0,0),health:P.PLAYER.MAX_HEALTH,maxHealth:P.PLAYER.MAX_HEALTH,currentTool:"net",tools:[...ve],isJumping:!1,isDashing:!1,isAttacking:!1,dashCooldown:0,invincibleTime:0,capturedMonkeys:0}),Ce=()=>({forward:!1,backward:!1,left:!1,right:!1,jump:!1,dash:!1,attack:!1,tool1:!1,tool2:!1,tool3:!1,tool4:!1,tool5:!1,pause:!1,mouseX:0,mouseY:0,mouseDeltaX:0,mouseDeltaY:0,isPointerLocked:!1}),Re=()=>({position:new x(0,5,10),target:new x(0,1,0),rotation:new $(0,0,0),distance:P.CAMERA.DISTANCE,pitch:.3,yaw:0}),de=()=>({musicVolume:.7,sfxVolume:.8,mouseSensitivity:1,invertY:!1,showTutorial:!0,language:"ja"}),D=he((s,n)=>({gameState:"menu",setGameState:t=>{console.log("setGameState called with:",t),s({gameState:t}),console.log("Game state updated to:",t)},currentStage:1,setCurrentStage:t=>s({currentStage:t}),stages:[...Ae],updateStageInfo:(t,r)=>s(o=>({stages:o.stages.map(a=>a.id===t?{...a,...r}:a)})),player:ce(),updatePlayer:t=>s(r=>({player:{...r.player,...t}})),resetPlayer:()=>s({player:ce()}),monkeys:[],setMonkeys:t=>s({monkeys:t}),updateMonkey:(t,r)=>s(o=>({monkeys:o.monkeys.map(a=>a.id===t?{...a,...r}:a)})),removeMonkey:t=>s(r=>({monkeys:r.monkeys.filter(o=>o.id!==t)})),boss:null,setBoss:t=>s({boss:t}),updateBoss:t=>s(r=>({boss:r.boss?{...r.boss,...t}:null})),input:Ce(),updateInput:t=>s(r=>({input:{...r.input,...t}})),camera:Re(),updateCamera:t=>s(r=>({camera:{...r.camera,...t}})),effects:[],addEffect:t=>s(r=>({effects:[...r.effects,t]})),removeEffect:t=>s(r=>({effects:r.effects.filter(o=>o.id!==t)})),clearEffects:()=>s({effects:[]}),gameTime:0,setGameTime:t=>s({gameTime:t}),incrementGameTime:t=>s(r=>({gameTime:r.gameTime+t})),result:null,setResult:t=>s({result:t}),settings:de(),updateSettings:t=>s(r=>({settings:{...r.settings,...t}})),saveGame:()=>{const t=n(),r={version:"1.0.0",stages:t.stages.reduce((o,a)=>(o[a.id]={unlocked:a.unlocked,cleared:a.cleared,bestTime:a.bestTime,bestRank:a.bestRank},o),{}),totalCaptured:t.player.capturedMonkeys,gallery:[],settings:t.settings};Te(le,r)},loadGame:()=>{const t={version:"1.0.0",stages:{},totalCaptured:0,gallery:[],settings:de()},r=Ie(le,t);s(o=>({stages:o.stages.map(a=>{const i=r.stages[a.id];return i?{...a,unlocked:i.unlocked,cleared:i.cleared,bestTime:i.bestTime,bestRank:i.bestRank}:a}),settings:r.settings}))},notification:null,setNotification:t=>s({notification:t}),showDamageFlash:!1,setShowDamageFlash:t=>s({showDamageFlash:t})})),Pe=()=>{const{input:s,updateInput:n,updatePlayer:t,gameState:r}=D(),o=p.useRef(!1),a=p.useCallback(g=>{if(r!=="playing"){O.PAUSE.includes(g.key)&&r==="paused"&&D.getState().setGameState("playing");return}const f={};O.FORWARD.includes(g.key)&&(f.forward=!0),O.BACKWARD.includes(g.key)&&(f.backward=!0),O.LEFT.includes(g.key)&&(f.left=!0),O.RIGHT.includes(g.key)&&(f.right=!0),O.JUMP.includes(g.key)&&(f.jump=!0),O.DASH.includes(g.key)&&(f.dash=!0),O.PAUSE.includes(g.key)&&D.getState().setGameState("paused"),O.TOOL_1.includes(g.key)&&t({currentTool:"net"}),O.TOOL_2.includes(g.key)&&t({currentTool:"rod"}),O.TOOL_3.includes(g.key)&&t({currentTool:"booster"}),O.TOOL_4.includes(g.key)&&t({currentTool:"hover"}),O.TOOL_5.includes(g.key)&&t({currentTool:"radar"}),Object.keys(f).length>0&&n(f)},[r,n,t]),i=p.useCallback(g=>{const f={};O.FORWARD.includes(g.key)&&(f.forward=!1),O.BACKWARD.includes(g.key)&&(f.backward=!1),O.LEFT.includes(g.key)&&(f.left=!1),O.RIGHT.includes(g.key)&&(f.right=!1),O.JUMP.includes(g.key)&&(f.jump=!1),O.DASH.includes(g.key)&&(f.dash=!1),Object.keys(f).length>0&&n(f)},[n]),c=p.useCallback(g=>{if(!o.current)return;const f=P.CAMERA.MOUSE_SENSITIVITY;n({mouseDeltaX:g.movementX*f,mouseDeltaY:g.movementY*f})},[n]),l=p.useCallback(g=>{r==="playing"&&g.button===0&&(n({attack:!0}),t({isAttacking:!0}))},[r,n,t]),u=p.useCallback(g=>{g.button===0&&(n({attack:!1}),t({isAttacking:!1}))},[n,t]),h=p.useCallback(()=>{o.current=document.pointerLockElement!==null,n({isPointerLocked:o.current})},[n]),d=p.useCallback(()=>{const g=document.querySelector("canvas");if(g&&!o.current&&"requestPointerLock"in g)try{g.requestPointerLock(),console.log("Pointer lock requested")}catch(f){console.warn("Pointer lock not supported:",f)}},[]),m=p.useCallback(()=>{o.current&&document.exitPointerLock()},[]);return p.useEffect(()=>(window.addEventListener("keydown",a),window.addEventListener("keyup",i),window.addEventListener("mousemove",c),window.addEventListener("mousedown",l),window.addEventListener("mouseup",u),document.addEventListener("pointerlockchange",h),()=>{window.removeEventListener("keydown",a),window.removeEventListener("keyup",i),window.removeEventListener("mousemove",c),window.removeEventListener("mousedown",l),window.removeEventListener("mouseup",u),document.removeEventListener("pointerlockchange",h)}),[a,i,c,l,u,h]),p.useEffect(()=>{r==="playing"?setTimeout(()=>{d()},100):m()},[r,d,m]),p.useEffect(()=>{const f=requestAnimationFrame(()=>{n({mouseDeltaX:0,mouseDeltaY:0})});return()=>cancelAnimationFrame(f)},[s.mouseDeltaX,s.mouseDeltaY,n]),{input:s,requestPointerLock:d,exitPointerLock:m,isPointerLocked:o.current}},De=()=>{const{updateInput:s,updatePlayer:n,gameState:t}=D(),r=p.useRef(null),o=p.useCallback(c=>{if(t!=="playing")return;const l=c.touches[0],u=window.innerWidth;l.clientX<u/2?r.current={startX:l.clientX,startY:l.clientY}:(s({attack:!0}),n({isAttacking:!0}))},[t,s,n]),a=p.useCallback(c=>{if(!r.current)return;const l=c.touches[0],u=l.clientX-r.current.startX,h=l.clientY-r.current.startY,d=20,m={forward:!1,backward:!1,left:!1,right:!1};Math.abs(h)>d&&(h<-d&&(m.forward=!0),h>d&&(m.backward=!0)),Math.abs(u)>d&&(u<-d&&(m.left=!0),u>d&&(m.right=!0)),s(m)},[s]),i=p.useCallback(()=>{r.current=null,s({forward:!1,backward:!1,left:!1,right:!1,attack:!1}),n({isAttacking:!1})},[s,n]);p.useEffect(()=>(window.addEventListener("touchstart",o),window.addEventListener("touchmove",a),window.addEventListener("touchend",i),()=>{window.removeEventListener("touchstart",o),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",i)}),[o,a,i])},Ge=(s,n)=>{const t=s.clone();return t.x=Math.max(-n,Math.min(n,t.x)),t.z=Math.max(-n,Math.min(n,t.z)),t},Be=(s,n,t,r)=>{let o=null;const a=[];for(const i of n){if(i.state==="captured")continue;const c=Q(s.position,i.position);if(r)if(t==="net"&&c<P.PLAYER.CAPTURE_RANGE){if(i.state==="stunned"||i.health<=0||i.health<=i.maxHealth*.5){o=i.id;break}}else t==="rod"&&c<P.PLAYER.ATTACK_RANGE&&a.push(i.id)}return{capturedId:o,hitIds:a}},Ne=s=>{const{monkey:n,player:t}=s,r=Q(n.position,t.position),o=q[n.type];return r<o.detectionRange?Math.min(n.alertLevel+s.deltaTime*2,1):Math.max(n.alertLevel-s.deltaTime*P.MONKEY.ALERT_DECAY_RATE,0)},Le=s=>{const{monkey:n,player:t}=s;if(n.state==="captured")return"captured";if(n.stunTime>0)return"stunned";const r=Q(n.position,t.position),o=q[n.type];if(n.alertLevel>.5)switch(o.behavior){case"flee":case"zigzag":return"fleeing";case"attack":return r<5?"attacking":"fleeing";case"hide":return"hidden";case"elite":return r<8?"attacking":"fleeing";default:return"fleeing"}else{if(n.alertLevel>.2)return"alert";if(n.patrolPoints.length>0)return"patrol"}return"idle"},ze=s=>{const{monkey:n,player:t}=s,r=q[n.type],o=ne(t.position,n.position);if(r.behavior==="zigzag"){const a=Math.sin(Date.now()*.005)*Math.PI/3;return new x(o.x*Math.cos(a)-o.z*Math.sin(a),0,o.x*Math.sin(a)+o.z*Math.cos(a)).normalize()}return o},_e=s=>{const{monkey:n,player:t}=s;return Q(n.position,t.position)<5&&n.state==="attacking"?{shouldAttack:!0,attackDirection:ne(n.position,t.position)}:{shouldAttack:!1,attackDirection:new x}},Oe=s=>{const{monkey:n}=s;if(n.patrolPoints.length===0)return null;const t=n.patrolPoints[n.currentPatrolIndex];return Q(n.position,t)<1?null:ne(n.position,t)},Ye=s=>{const{monkey:n,deltaTime:t}=s,r=q[n.type];let o=new x,a=r.speed;switch(n.state){case"fleeing":{o=ze(s).multiplyScalar(a);break}case"attacking":{const{attackDirection:h}=_e(s);o=h.multiplyScalar(a*.5);break}case"patrol":{const h=Oe(s);h&&(o=h.multiplyScalar(a*.5));break}case"alert":{o=ne(s.player.position,n.position).multiplyScalar(a*.3);break}case"hidden":case"idle":case"stunned":case"captured":default:o=new x;break}const i=n.velocity.clone().lerp(o,t*5),c=n.position.clone().add(i.clone().multiplyScalar(t));c.y=Math.max(c.y,1);const l=P.STAGE.BOUNDARY;c.x=Math.max(-l,Math.min(l,c.x)),c.z=Math.max(-l,Math.min(l,c.z));let u=n.rotation.clone();if(i.length()>.1){const h=Math.atan2(i.x,i.z),d=n.rotation.y,m=Ee(h-d);u.y=d+m*t*10}return{position:c,velocity:i,rotation:u}},He=(s,n,t)=>{const r=q[s];return{id:G(),type:s,position:n.clone(),rotation:new $(0,j(0,Math.PI*2),0),velocity:new x,state:"idle",health:r.maxHealth,maxHealth:r.maxHealth,stunTime:0,alertLevel:0,targetPosition:null,patrolPoints:t||[],currentPatrolIndex:0,isBoss:!1}},Ue=(s,n,t)=>{const r=[],o=Math.PI*2/n;for(let a=0;a<n;a++){const i=o*a+j(-.3,.3),c=t*j(.7,1.3);r.push(new x(s.x+Math.cos(i)*c,s.y,s.z+Math.sin(i)*c))}return r},$e=()=>{const{player:s,updatePlayer:n,monkeys:t,updateMonkey:r,boss:o,updateBoss:a,camera:i,updateCamera:c,input:l,gameState:u,incrementGameTime:h,addEffect:d,setNotification:m,setResult:g,setGameState:f,currentStage:S,stages:E,updateStageInfo:L,gameTime:v}=D(),Y=p.useRef([]),U=p.useCallback(C=>{if(u!=="playing")return;let F=s.velocity.clone(),w=s.position.clone(),b=s.isJumping,T=s.isDashing,N=s.dashCooldown,y=Math.max(0,s.invincibleTime-C);F.y+=P.PLAYER.GRAVITY*C;const k=new x;if(l.forward&&(k.z-=1),l.backward&&(k.z+=1),l.left&&(k.x-=1),l.right&&(k.x+=1),k.length()>0){k.normalize();const J=new Me().makeRotationY(i.yaw);k.applyMatrix4(J);const I=T?P.PLAYER.DASH_SPEED:P.PLAYER.MOVE_SPEED;F.x=k.x*I,F.z=k.z*I}else F.x*=.8,F.z*=.8;l.jump&&!b&&(F.y=P.PLAYER.JUMP_FORCE,b=!0),N=Math.max(0,N-C),l.dash&&N<=0&&!T&&(T=!0,N=P.PLAYER.DASH_COOLDOWN,setTimeout(()=>{n({isDashing:!1})},P.PLAYER.DASH_DURATION*1e3)),w.add(F.clone().multiplyScalar(C)),w.y<=1&&(w.y=1,F.y=0,b=!1),w=Ge(w,P.STAGE.BOUNDARY);let _=s.rotation.clone();(Math.abs(F.x)>.1||Math.abs(F.z)>.1)&&(_.y=Math.atan2(F.x,F.z)),n({position:w,velocity:F,rotation:_,isJumping:b,isDashing:T,dashCooldown:N,invincibleTime:y})},[s,l,i.yaw,u,n]),z=p.useCallback(C=>{const{yaw:F,pitch:w,distance:b}=i;let T=F-l.mouseDeltaX,N=w-l.mouseDeltaY;N=Math.max(P.CAMERA.MIN_PITCH,Math.min(P.CAMERA.MAX_PITCH,N));const y=new x(Math.sin(T)*Math.cos(N)*b,Math.sin(N)*b+P.CAMERA.HEIGHT_OFFSET,Math.cos(T)*Math.cos(N)*b),k=s.position.clone().add(y),_=i.position.clone().lerp(k,P.CAMERA.LERP_SPEED*C);c({position:_,target:s.position.clone(),yaw:T,pitch:N})},[i,l.mouseDeltaX,l.mouseDeltaY,s.position,c]),M=p.useCallback(C=>{u==="playing"&&t.forEach(F=>{if(F.state==="captured")return;let w=Math.max(0,F.stunTime-C);const b={monkey:F,player:s,deltaTime:C,obstacles:Y.current,otherMonkeys:t.filter(J=>J.id!==F.id)},T=Ne(b),N=w>0?"stunned":Le({...b,monkey:{...F,alertLevel:T}}),{position:y,velocity:k,rotation:_}=Ye({...b,monkey:{...F,state:N,alertLevel:T}});r(F.id,{position:y,velocity:k,rotation:_,state:N,stunTime:w,alertLevel:T})})},[u,t,s,r]),H=p.useCallback(()=>{if(u!=="playing"||!s.isAttacking)return;const{capturedId:C,hitIds:F}=Be(s,t,s.currentTool,s.isAttacking);if(C){const w=t.find(b=>b.id===C);if(w){r(C,{state:"captured"}),d({id:G(),type:"capture",position:w.position.clone(),duration:1,elapsed:0,color:"#00FF00"});const b=s.capturedMonkeys+1;n({capturedMonkeys:b}),m(`çŒ¿ã‚’æ•ç²ï¼ (${b}/${t.length})`),setTimeout(()=>{D.getState().monkeys.filter(N=>N.state!=="captured").length===0&&B()},100)}}if(F.forEach(w=>{const b=t.find(T=>T.id===w);if(b&&b.state!=="stunned"){const T=b.health-P.PLAYER.ATTACK_DAMAGE;T<=0?r(w,{health:0,state:"stunned",stunTime:P.MONKEY.STUN_DURATION}):r(w,{health:T}),d({id:G(),type:"hit",position:b.position.clone(),duration:.3,elapsed:0,color:"#FF4444"})}}),o&&o.state!=="captured"&&s.isAttacking&&s.position.distanceTo(o.position)<P.PLAYER.ATTACK_RANGE*1.5){const b=s.currentTool==="rod"?2:1,T=Math.max(0,o.health-b);D.getState().updateBoss({health:T}),d({id:G(),type:"hit",position:o.position.clone().add(new x(0,2,0)),duration:.5,elapsed:0,color:"#FFD700"}),T<=0&&(D.getState().updateBoss({state:"captured"}),m("ãƒœã‚¹æ’ƒç ´ï¼ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢ï¼"),setTimeout(()=>{B()},1e3))}},[u,s,t,o,r,a,n,d,m]),B=p.useCallback(()=>{const C=P.PLAYER.MAX_HEALTH-s.health,F=v;let w="C";F<=180&&C===0?w="S":F<=300&&C<=30?w="A":F<=600&&(w="B"),g({stageId:S,cleared:!0,capturedCount:s.capturedMonkeys,totalMonkeys:t.length,clearTime:F,damageTaken:C,rank:w});const b=E.find(T=>T.id===S);L(S,{cleared:!0,bestTime:b!=null&&b.bestTime?Math.min(b.bestTime,F):F,bestRank:!(b!=null&&b.bestRank)||["S","A","B","C"].indexOf(w)<["S","A","B","C"].indexOf(b.bestRank)?w:b.bestRank}),S<5&&L(S+1,{unlocked:!0}),f("result")},[s,v,S,E,t.length,g,L,f]);return K((C,F)=>{if(u!=="playing")return;const w=Math.min(F,.1);h(w),U(w),z(w),M(w),H()}),{obstaclesRef:Y}},Ke=()=>{const{player:s,gameState:n}=D(),t=p.useRef(null),r=p.useRef(null),o=p.useRef(null),a=p.useRef(null),i=p.useRef(null),c=p.useRef(null),l=p.useRef(0),u=p.useRef(0),h={net:"#00FF00",rod:"#FFD700",booster:"#00BFFF",hover:"#9370DB",radar:"#FF6347"};K((m,g)=>{if(!t.current)return;if(t.current.position.copy(s.position),t.current.rotation.copy(s.rotation),s.isAttacking){if(u.current+=g*15,o.current){const S=Math.sin(u.current*2)*2;o.current.rotation.x=-1.5+S,o.current.rotation.z=S*.5}if(c.current){const S=Math.sin(u.current*2);c.current.rotation.x=S*.8,c.current.rotation.y=S*1.2}u.current>Math.PI&&(u.current=0)}else u.current=0;if((Math.abs(s.velocity.x)>.1||Math.abs(s.velocity.z)>.1)&&n==="playing"&&!s.isAttacking){l.current+=g*10;const S=Math.sin(l.current)*.5;r.current&&(r.current.rotation.x=S),o.current&&!s.isAttacking&&(o.current.rotation.x=-S),a.current&&(a.current.rotation.x=-S),i.current&&(i.current.rotation.x=S)}else s.isAttacking||(l.current=0,r.current&&(r.current.rotation.x=0),o.current&&(o.current.rotation.x=0,o.current.rotation.z=0),a.current&&(a.current.rotation.x=0),i.current&&(i.current.rotation.x=0));s.isDashing?t.current.rotation.x=.3:t.current.rotation.x=0,s.invincibleTime>0?t.current.visible=Math.floor(s.invincibleTime*10)%2===0:t.current.visible=!0});const d=h[s.currentTool]||"#FFFFFF";return e.jsxs("group",{ref:t,children:[e.jsxs("mesh",{position:[0,.9,0],castShadow:!0,children:[e.jsx("sphereGeometry",{args:[.3,16,16]}),e.jsx("meshStandardMaterial",{color:R.PLAYER.SKIN})]}),e.jsxs("mesh",{position:[0,1.05,-.05],castShadow:!0,children:[e.jsx("sphereGeometry",{args:[.25,16,16]}),e.jsx("meshStandardMaterial",{color:R.PLAYER.HAIR})]}),e.jsxs("mesh",{position:[.1,.95,.25],children:[e.jsx("sphereGeometry",{args:[.05,8,8]}),e.jsx("meshStandardMaterial",{color:"#000000"})]}),e.jsxs("mesh",{position:[-.1,.95,.25],children:[e.jsx("sphereGeometry",{args:[.05,8,8]}),e.jsx("meshStandardMaterial",{color:"#000000"})]}),e.jsxs("mesh",{position:[0,.35,0],castShadow:!0,children:[e.jsx("capsuleGeometry",{args:[.25,.5,8,16]}),e.jsx("meshStandardMaterial",{color:R.PLAYER.BODY})]}),e.jsxs("group",{position:[.35,.5,0],children:[e.jsxs("mesh",{ref:r,position:[0,-.2,0],castShadow:!0,children:[e.jsx("capsuleGeometry",{args:[.08,.4,4,8]}),e.jsx("meshStandardMaterial",{color:R.PLAYER.BODY})]}),e.jsxs("mesh",{position:[0,-.45,0],children:[e.jsx("sphereGeometry",{args:[.1,8,8]}),e.jsx("meshStandardMaterial",{color:R.PLAYER.SKIN})]})]}),e.jsxs("group",{position:[-.35,.5,0],children:[e.jsxs("mesh",{ref:o,position:[0,-.2,0],castShadow:!0,children:[e.jsx("capsuleGeometry",{args:[.08,.4,4,8]}),e.jsx("meshStandardMaterial",{color:R.PLAYER.BODY})]}),e.jsxs("mesh",{position:[0,-.45,.1],children:[e.jsx("sphereGeometry",{args:[.1,8,8]}),e.jsx("meshStandardMaterial",{color:R.PLAYER.SKIN})]}),s.currentTool==="net"&&e.jsxs("group",{ref:c,position:[0,-.5,.5],children:[e.jsxs("mesh",{rotation:[Math.PI/4,0,0],children:[e.jsx("cylinderGeometry",{args:[.03,.03,.8,8]}),e.jsx("meshStandardMaterial",{color:"#8B4513"})]}),e.jsxs("mesh",{position:[0,.5,0],rotation:[Math.PI/2,0,0],children:[e.jsx("torusGeometry",{args:[.25,.02,8,16]}),e.jsx("meshStandardMaterial",{color:d})]}),e.jsxs("mesh",{position:[0,.5,0],rotation:[Math.PI/2,0,0],children:[e.jsx("circleGeometry",{args:[.25,16]}),e.jsx("meshStandardMaterial",{color:d,transparent:!0,opacity:.4,wireframe:!0})]})]}),s.currentTool!=="net"&&e.jsxs("mesh",{position:[0,-.5,.3],rotation:[Math.PI/4,0,0],children:[e.jsx("cylinderGeometry",{args:[.05,.05,.5,8]}),e.jsx("meshStandardMaterial",{color:d,emissive:d,emissiveIntensity:.3})]})]}),e.jsxs("group",{position:[.12,-.1,0],children:[e.jsxs("mesh",{ref:a,position:[0,-.3,0],castShadow:!0,children:[e.jsx("capsuleGeometry",{args:[.1,.4,4,8]}),e.jsx("meshStandardMaterial",{color:R.PLAYER.BODY})]}),e.jsxs("mesh",{position:[0,-.6,.05],children:[e.jsx("boxGeometry",{args:[.15,.1,.25]}),e.jsx("meshStandardMaterial",{color:"#333333"})]})]}),e.jsxs("group",{position:[-.12,-.1,0],children:[e.jsxs("mesh",{ref:i,position:[0,-.3,0],castShadow:!0,children:[e.jsx("capsuleGeometry",{args:[.1,.4,4,8]}),e.jsx("meshStandardMaterial",{color:R.PLAYER.BODY})]}),e.jsxs("mesh",{position:[0,-.6,.05],children:[e.jsx("boxGeometry",{args:[.15,.1,.25]}),e.jsx("meshStandardMaterial",{color:"#333333"})]})]}),s.isAttacking&&s.currentTool==="net"&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[0,.5,1],rotation:[0,0,u.current],children:[e.jsx("torusGeometry",{args:[.8,.1,8,16]}),e.jsx("meshBasicMaterial",{color:d,transparent:!0,opacity:.6,side:re})]}),e.jsxs("mesh",{position:[Math.cos(u.current)*.8,.5,1+Math.sin(u.current)*.8],children:[e.jsx("sphereGeometry",{args:[.1,8,8]}),e.jsx("meshBasicMaterial",{color:"#FFFF00",transparent:!0,opacity:.8})]})]}),s.isAttacking&&s.currentTool!=="net"&&e.jsxs("mesh",{position:[0,.5,1.5],rotation:[0,0,Math.PI/4],children:[e.jsx("ringGeometry",{args:[.3,.5,8]}),e.jsx("meshBasicMaterial",{color:d,transparent:!0,opacity:.7,side:re})]}),s.isDashing&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[0,.5,-.5],children:[e.jsx("coneGeometry",{args:[.3,.8,8]}),e.jsx("meshBasicMaterial",{color:"#00BFFF",transparent:!0,opacity:.5})]}),e.jsxs("mesh",{position:[0,.5,-1],children:[e.jsx("coneGeometry",{args:[.2,.5,8]}),e.jsx("meshBasicMaterial",{color:"#00BFFF",transparent:!0,opacity:.3})]})]})]})},We=({data:s})=>{const n=p.useRef(null),t=p.useRef(null),r=p.useRef(null),o=p.useRef(null),a=p.useRef(Math.random()*Math.PI*2),i=p.useMemo(()=>q[s.type].color,[s.type]),c=p.useMemo(()=>s.state==="stunned"?"#888888":s.alertLevel>.5?"#FF0000":s.alertLevel>.2?"#FFFF00":"#00FF00",[s.alertLevel,s.state]);K((u,h)=>{if(!n.current)return;if(s.state==="captured"){n.current.visible=!1;return}n.current.visible=!0,n.current.position.copy(s.position),n.current.rotation.copy(s.rotation),a.current+=h*(s.state==="fleeing"?15:5);const m=s.velocity.length()>.1?Math.sin(a.current)*.6:Math.sin(a.current*.5)*.1;t.current&&(t.current.rotation.x=m),r.current&&(r.current.rotation.x=-m),o.current&&(o.current.rotation.x=Math.sin(a.current*.5)*.3-.5,o.current.rotation.z=Math.sin(a.current*.7)*.2),s.state==="stunned"?n.current.rotation.z=Math.sin(a.current*3)*.1:n.current.rotation.z=0});const l=s.state==="hidden"?.3:1;return e.jsxs("group",{ref:n,children:[e.jsxs("mesh",{position:[0,.7,0],castShadow:!0,children:[e.jsx("sphereGeometry",{args:[.25,16,16]}),e.jsx("meshStandardMaterial",{color:i,transparent:!0,opacity:l})]}),e.jsxs("mesh",{position:[0,.65,.15],children:[e.jsx("sphereGeometry",{args:[.15,12,12]}),e.jsx("meshStandardMaterial",{color:"#FFDAB9",transparent:!0,opacity:l})]}),e.jsxs("mesh",{position:[.08,.72,.25],children:[e.jsx("sphereGeometry",{args:[.04,8,8]}),e.jsx("meshStandardMaterial",{color:"#FFFFFF"})]}),e.jsxs("mesh",{position:[-.08,.72,.25],children:[e.jsx("sphereGeometry",{args:[.04,8,8]}),e.jsx("meshStandardMaterial",{color:"#FFFFFF"})]}),e.jsxs("mesh",{position:[.08,.72,.28],children:[e.jsx("sphereGeometry",{args:[.02,8,8]}),e.jsx("meshStandardMaterial",{color:"#000000"})]}),e.jsxs("mesh",{position:[-.08,.72,.28],children:[e.jsx("sphereGeometry",{args:[.02,8,8]}),e.jsx("meshStandardMaterial",{color:"#000000"})]}),e.jsxs("mesh",{position:[.22,.75,0],children:[e.jsx("sphereGeometry",{args:[.1,8,8]}),e.jsx("meshStandardMaterial",{color:i,transparent:!0,opacity:l})]}),e.jsxs("mesh",{position:[-.22,.75,0],children:[e.jsx("sphereGeometry",{args:[.1,8,8]}),e.jsx("meshStandardMaterial",{color:i,transparent:!0,opacity:l})]}),e.jsxs("mesh",{position:[0,.85,0],castShadow:!0,children:[e.jsx("sphereGeometry",{args:[.22,16,16,0,Math.PI*2,0,Math.PI/2]}),e.jsx("meshStandardMaterial",{color:R.MONKEY.HELMET,metalness:.8,roughness:.2,transparent:!0,opacity:l})]}),e.jsxs("mesh",{position:[0,.95,.1],children:[e.jsx("sphereGeometry",{args:[.05,8,8]}),e.jsx("meshStandardMaterial",{color:c,emissive:c,emissiveIntensity:s.state==="stunned"?.2:1})]}),e.jsxs("mesh",{position:[0,1.05,0],children:[e.jsx("cylinderGeometry",{args:[.02,.02,.15,8]}),e.jsx("meshStandardMaterial",{color:"#555555",metalness:.8,roughness:.2})]}),e.jsxs("mesh",{position:[0,1.15,0],children:[e.jsx("sphereGeometry",{args:[.04,8,8]}),e.jsx("meshStandardMaterial",{color:c,emissive:c,emissiveIntensity:.5})]}),e.jsxs("mesh",{position:[0,.3,0],castShadow:!0,children:[e.jsx("sphereGeometry",{args:[.25,16,16]}),e.jsx("meshStandardMaterial",{color:i,transparent:!0,opacity:l})]}),e.jsxs("mesh",{position:[0,.3,.1],children:[e.jsx("sphereGeometry",{args:[.18,12,12]}),e.jsx("meshStandardMaterial",{color:"#FFDAB9",transparent:!0,opacity:l})]}),e.jsxs("group",{position:[.28,.4,0],children:[e.jsxs("mesh",{ref:t,position:[0,-.15,0],castShadow:!0,children:[e.jsx("capsuleGeometry",{args:[.06,.25,4,8]}),e.jsx("meshStandardMaterial",{color:i,transparent:!0,opacity:l})]}),e.jsxs("mesh",{position:[0,-.35,0],children:[e.jsx("sphereGeometry",{args:[.07,8,8]}),e.jsx("meshStandardMaterial",{color:"#FFDAB9",transparent:!0,opacity:l})]})]}),e.jsxs("group",{position:[-.28,.4,0],children:[e.jsxs("mesh",{ref:r,position:[0,-.15,0],castShadow:!0,children:[e.jsx("capsuleGeometry",{args:[.06,.25,4,8]}),e.jsx("meshStandardMaterial",{color:i,transparent:!0,opacity:l})]}),e.jsxs("mesh",{position:[0,-.35,0],children:[e.jsx("sphereGeometry",{args:[.07,8,8]}),e.jsx("meshStandardMaterial",{color:"#FFDAB9",transparent:!0,opacity:l})]})]}),e.jsxs("group",{position:[.1,.05,0],children:[e.jsxs("mesh",{position:[0,-.1,0],castShadow:!0,children:[e.jsx("capsuleGeometry",{args:[.07,.15,4,8]}),e.jsx("meshStandardMaterial",{color:i,transparent:!0,opacity:l})]}),e.jsxs("mesh",{position:[0,-.25,.05],children:[e.jsx("sphereGeometry",{args:[.08,8,8]}),e.jsx("meshStandardMaterial",{color:"#FFDAB9",transparent:!0,opacity:l})]})]}),e.jsxs("group",{position:[-.1,.05,0],children:[e.jsxs("mesh",{position:[0,-.1,0],castShadow:!0,children:[e.jsx("capsuleGeometry",{args:[.07,.15,4,8]}),e.jsx("meshStandardMaterial",{color:i,transparent:!0,opacity:l})]}),e.jsxs("mesh",{position:[0,-.25,.05],children:[e.jsx("sphereGeometry",{args:[.08,8,8]}),e.jsx("meshStandardMaterial",{color:"#FFDAB9",transparent:!0,opacity:l})]})]}),e.jsxs("mesh",{ref:o,position:[0,.2,-.25],rotation:[-.5,0,0],castShadow:!0,children:[e.jsx("coneGeometry",{args:[.05,.5,8]}),e.jsx("meshStandardMaterial",{color:i,transparent:!0,opacity:l})]}),s.state==="stunned"&&e.jsx("group",{position:[0,1.3,0],children:[0,1,2].map(u=>e.jsxs("mesh",{position:[Math.cos(u/3*Math.PI*2+a.current)*.3,0,Math.sin(u/3*Math.PI*2+a.current)*.3],rotation:[0,0,a.current],children:[e.jsx("octahedronGeometry",{args:[.08]}),e.jsx("meshStandardMaterial",{color:"#FFFF00",emissive:"#FFFF00",emissiveIntensity:.5})]},u))}),s.alertLevel>.5&&s.state!=="stunned"&&e.jsxs("mesh",{position:[0,1.4,0],children:[e.jsx("coneGeometry",{args:[.1,.25,3]}),e.jsx("meshStandardMaterial",{color:"#FF0000",emissive:"#FF0000",emissiveIntensity:.5})]})]})},Xe={1:{name:"ã‚¸ãƒ£ãƒ³ã‚°ãƒ«ã‚¨ãƒªã‚¢",groundColor:R.STAGE.JUNGLE.GROUND,skyColor:R.STAGE.JUNGLE.SKY,fogColor:R.STAGE.JUNGLE.FOG,fogNear:30,fogFar:100},2:{name:"ã‚¢ã‚¤ã‚¹ãƒã‚¦ãƒ³ãƒ†ãƒ³",groundColor:R.STAGE.ICE.GROUND,skyColor:R.STAGE.ICE.SKY,fogColor:R.STAGE.ICE.FOG,fogNear:20,fogFar:80},3:{name:"éºè·¡ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³",groundColor:R.STAGE.RUINS.GROUND,skyColor:R.STAGE.RUINS.SKY,fogColor:R.STAGE.RUINS.FOG,fogNear:25,fogFar:70},4:{name:"ãƒ¡ã‚«ãƒ‹ã‚«ãƒ«ã‚·ãƒ†ã‚£",groundColor:R.STAGE.MECHANICAL.GROUND,skyColor:R.STAGE.MECHANICAL.SKY,fogColor:R.STAGE.MECHANICAL.FOG,fogNear:20,fogFar:60},5:{name:"ãƒœãƒ«ã‚±ãƒ¼ãƒãƒ™ãƒ¼ã‚¹",groundColor:R.STAGE.VOLCANO.GROUND,skyColor:R.STAGE.VOLCANO.SKY,fogColor:R.STAGE.VOLCANO.FOG,fogNear:15,fogFar:50}},Ve=s=>{const n=[];switch(s){case 1:for(let t=0;t<8;t++)n.push({id:G(),position:new x(j(-30,30),j(2,6),j(-30,30)),size:new x(3,.5,3),type:"static",color:"#8B4513"});for(let t=0;t<5;t++)n.push({id:G(),position:new x(j(-25,25),j(8,12),j(-25,25)),size:new x(4,.3,4),type:"static",color:"#228B22"});break;case 2:for(let t=0;t<10;t++)n.push({id:G(),position:new x(j(-35,35),j(1,8),j(-35,35)),size:new x(4,.5,4),type:"ice",color:"#B0E0E6"});break;case 3:for(let t=0;t<12;t++)n.push({id:G(),position:new x(j(-30,30),j(2,10),j(-30,30)),size:new x(3,1,3),type:"static",color:"#A0A0A0"});break;case 4:for(let t=0;t<6;t++)n.push({id:G(),position:new x(j(-35,35),j(3,10),j(-35,35)),size:new x(4,.5,4),type:"moving",moveRange:new x(10,0,0),moveSpeed:2,color:"#4682B4"});for(let t=0;t<8;t++)n.push({id:G(),position:new x(j(-35,35),j(2,12),j(-35,35)),size:new x(3,.5,3),type:"static",color:"#708090"});break;case 5:for(let t=0;t<10;t++)n.push({id:G(),position:new x(j(-40,40),j(2,12),j(-40,40)),size:new x(3,1,3),type:"static",color:"#4A4A4A"});for(let t=0;t<5;t++)n.push({id:G(),position:new x(j(-35,35),j(4,8),j(-35,35)),size:new x(3,.5,3),type:"falling",color:"#8B0000"});break}return n},Je=s=>{const n=[];switch(s){case 1:for(let t=0;t<20;t++){const r=j(-40,40),o=j(-40,40);(Math.abs(r)>5||Math.abs(o)>5)&&n.push({id:G(),position:new x(r,4,o),size:new x(1.5,8,1.5),type:"tree",color:"#8B4513",isDestructible:!1})}for(let t=0;t<10;t++)n.push({id:G(),position:new x(j(-35,35),1,j(-35,35)),size:new x(2,2,2),type:"rock",color:"#696969",isDestructible:!1});break;case 2:for(let t=0;t<15;t++)n.push({id:G(),position:new x(j(-40,40),3,j(-40,40)),size:new x(1,6,1),type:"pillar",color:"#E0FFFF",isDestructible:!0});for(let t=0;t<8;t++)n.push({id:G(),position:new x(j(-35,35),1.5,j(-35,35)),size:new x(3,3,3),type:"rock",color:"#FFFAFA",isDestructible:!1});break;case 3:for(let t=0;t<16;t++)n.push({id:G(),position:new x(j(-35,35),4,j(-35,35)),size:new x(1.5,8,1.5),type:"pillar",color:"#D2B48C",isDestructible:!1});for(let t=0;t<6;t++)n.push({id:G(),position:new x(j(-30,30),2,j(-30,30)),size:new x(2,4,2),type:"block",color:"#8B8378",isDestructible:!1});break;case 4:for(let t=0;t<15;t++)n.push({id:G(),position:new x(j(-40,40),2,j(-40,40)),size:new x(3,4,3),type:"block",color:"#4A4A4A",isDestructible:!1});for(let t=0;t<10;t++)n.push({id:G(),position:new x(j(-35,35),1,j(-35,35)),size:new x(1,2,8),type:"block",color:"#696969",isDestructible:!1});break;case 5:for(let t=0;t<12;t++)n.push({id:G(),position:new x(j(-40,40),2,j(-40,40)),size:new x(3,4,3),type:"rock",color:"#2F2F2F",isDestructible:!1});break}return n},Ze=s=>{const n=[],r={1:{yellow:12,blue:3,red:0,green:0,black:0},2:{yellow:8,blue:6,red:4,green:0,black:0},3:{yellow:6,blue:4,red:4,green:4,black:2},4:{yellow:5,blue:3,red:8,green:2,black:7},5:{yellow:8,blue:5,red:6,green:5,black:6}}[s];return["yellow","blue","red","green","black"].forEach(a=>{const i=r[a];for(let c=0;c<i;c++){const l=Math.random()*Math.PI*2,u=j(10,40);n.push({position:new x(Math.cos(l)*u,1,Math.sin(l)*u),type:a})}}),n},qe=({stageId:s})=>{const n=Xe[s],t=p.useMemo(()=>Ve(s),[s]),r=p.useMemo(()=>Je(s),[s]);return e.jsxs("group",{children:[e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,0,0],receiveShadow:!0,children:[e.jsx("planeGeometry",{args:[100,100]}),e.jsx("meshStandardMaterial",{color:n.groundColor})]}),e.jsx("gridHelper",{args:[100,50,"#444444","#333333"],position:[0,.01,0]}),[-50,50].map((o,a)=>e.jsxs("mesh",{position:[o,10,0],children:[e.jsx("boxGeometry",{args:[1,20,100]}),e.jsx("meshStandardMaterial",{color:"#FF0000",transparent:!0,opacity:.1})]},`wall-x-${a}`)),[-50,50].map((o,a)=>e.jsxs("mesh",{position:[0,10,o],children:[e.jsx("boxGeometry",{args:[100,20,1]}),e.jsx("meshStandardMaterial",{color:"#FF0000",transparent:!0,opacity:.1})]},`wall-z-${a}`)),t.map(o=>e.jsxs("mesh",{position:o.position,castShadow:!0,receiveShadow:!0,children:[e.jsx("boxGeometry",{args:[o.size.x,o.size.y,o.size.z]}),e.jsx("meshStandardMaterial",{color:o.color,transparent:o.type==="ice",opacity:o.type==="ice"?.8:1})]},o.id)),r.map(o=>e.jsx("group",{position:o.position,children:o.type==="tree"?e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[0,-2,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.3,.5,4,8]}),e.jsx("meshStandardMaterial",{color:o.color})]}),e.jsxs("mesh",{position:[0,1,0],castShadow:!0,children:[e.jsx("coneGeometry",{args:[2,4,8]}),e.jsx("meshStandardMaterial",{color:"#228B22"})]}),e.jsxs("mesh",{position:[0,2.5,0],castShadow:!0,children:[e.jsx("coneGeometry",{args:[1.5,3,8]}),e.jsx("meshStandardMaterial",{color:"#2E8B57"})]})]}):o.type==="pillar"?e.jsxs("mesh",{castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[o.size.x/2,o.size.x/2,o.size.y,8]}),e.jsx("meshStandardMaterial",{color:o.color})]}):o.type==="rock"?e.jsxs("mesh",{castShadow:!0,children:[e.jsx("dodecahedronGeometry",{args:[o.size.x/2,0]}),e.jsx("meshStandardMaterial",{color:o.color,flatShading:!0})]}):e.jsxs("mesh",{castShadow:!0,children:[e.jsx("boxGeometry",{args:[o.size.x,o.size.y,o.size.z]}),e.jsx("meshStandardMaterial",{color:o.color})]})},o.id)),s===1&&e.jsx(Qe,{}),s===2&&e.jsx(et,{}),s===3&&e.jsx(tt,{}),s===4&&e.jsx(st,{}),s===5&&e.jsx(nt,{})]})},Qe=()=>e.jsx("group",{children:Array.from({length:10}).map((s,n)=>e.jsxs("mesh",{position:[j(-40,40),8,j(-40,40)],children:[e.jsx("cylinderGeometry",{args:[.05,.05,10,8]}),e.jsx("meshStandardMaterial",{color:"#228B22"})]},`vine-${n}`))}),et=()=>e.jsx("group",{children:Array.from({length:30}).map((s,n)=>e.jsxs("mesh",{position:[j(-40,40),j(1,15),j(-40,40)],children:[e.jsx("octahedronGeometry",{args:[.1]}),e.jsx("meshStandardMaterial",{color:"#FFFFFF"})]},`snow-${n}`))}),tt=()=>e.jsx("group",{children:Array.from({length:5}).map((s,n)=>e.jsxs("mesh",{position:[j(-35,35),.5,j(-35,35)],rotation:[j(-.3,.3),0,j(-.3,.3)],children:[e.jsx("cylinderGeometry",{args:[.8,1,1,8]}),e.jsx("meshStandardMaterial",{color:"#D2B48C"})]},`broken-${n}`))}),st=()=>e.jsx("group",{children:Array.from({length:8}).map((s,n)=>e.jsxs("mesh",{position:[j(-40,40),.02,j(-40,40)],rotation:[-Math.PI/2,0,0],children:[e.jsx("planeGeometry",{args:[3,3]}),e.jsx("meshStandardMaterial",{color:"#00BFFF",emissive:"#00BFFF",emissiveIntensity:.3})]},`panel-${n}`))}),nt=()=>e.jsxs("group",{children:[Array.from({length:6}).map((s,n)=>e.jsx("pointLight",{position:[j(-30,30),.5,j(-30,30)],color:"#FF4500",intensity:2,distance:10},`lava-light-${n}`)),Array.from({length:4}).map((s,n)=>e.jsxs("mesh",{position:[j(-35,35),.1,j(-35,35)],rotation:[-Math.PI/2,0,0],children:[e.jsx("circleGeometry",{args:[3,16]}),e.jsx("meshStandardMaterial",{color:"#FF4500",emissive:"#FF4500",emissiveIntensity:.5})]},`lava-${n}`))]}),fe={1:{name:"ã‚¸ãƒ£ãƒ³ã‚°ãƒ«ã‚­ãƒ³ã‚°",color:"#DC143C",scale:2,maxHealth:30,attacks:["banana_throw","ground_pound","vine_charge"]},2:{name:"ãƒ•ãƒ­ã‚¹ãƒˆãƒªãƒ¼ãƒ€ãƒ¼",color:"#E0FFFF",scale:1.8,maxHealth:40,attacks:["ice_spike","ice_wall","snowball_roll"]},3:{name:"ãƒ†ãƒ³ãƒ—ãƒ«ã‚¬ãƒ¼ãƒ‡ã‚£ã‚¢ãƒ³",color:"#FFD700",scale:2.2,maxHealth:50,attacks:["laser_beam","summon_minions","teleport"]},4:{name:"ã‚µã‚¤ãƒãƒ¼ã‚¨ã‚¤ãƒ—",color:"#4682B4",scale:2.5,maxHealth:60,attacks:["missile","electric_shock","hover_attack","shield"]},5:{name:"ãƒ¡ã‚¬ã‚¹ãƒšã‚¯ã‚¿ãƒ¼",color:"#8B0000",scale:3,maxHealth:100,attacks:["energy_ball","shockwave","meteor","fire_pillar","all_laser"]}},ot=({stageId:s,bossData:n})=>{const{player:t,addEffect:r}=D(),o=p.useRef(null),a=p.useRef(0),i=p.useRef(0),c=fe[s];K((h,d)=>{if(!o.current||n.state==="captured")return;a.current+=d,o.current.position.copy(n.position);const m=new x().subVectors(t.position,n.position).normalize(),g=Math.atan2(m.x,m.z);if(o.current.rotation.y=g,i.current=Math.max(0,i.current-d),n.state!=="stunned"&&i.current<=0){const f=Q(n.position,t.position),E=3-((n.bossPhase||1)-1)*.5;f<15&&(r({id:G(),type:"explosion",position:n.position.clone(),duration:.5,elapsed:0,color:c.color}),i.current=E)}n.state==="stunned"?o.current.rotation.z=Math.sin(a.current*10)*.2:o.current.rotation.z=0,o.current.position.y=n.position.y+Math.sin(a.current*2)*.2});const l=p.useMemo(()=>{switch(n.bossPhase||1){case 1:return c.color;case 2:return"#FF6600";case 3:return"#FF0000";default:return c.color}},[n.bossPhase,c.color]),u=c.scale;return n.state==="captured"?null:e.jsxs("group",{ref:o,scale:[u,u,u],children:[e.jsxs("mesh",{position:[0,.8,0],castShadow:!0,children:[e.jsx("sphereGeometry",{args:[.35,16,16]}),e.jsx("meshStandardMaterial",{color:l})]}),e.jsxs("mesh",{position:[0,.75,.2],children:[e.jsx("sphereGeometry",{args:[.2,12,12]}),e.jsx("meshStandardMaterial",{color:"#FFDAB9"})]}),e.jsxs("mesh",{position:[.1,.82,.3],children:[e.jsx("sphereGeometry",{args:[.06,8,8]}),e.jsx("meshStandardMaterial",{color:"#FF0000",emissive:"#FF0000",emissiveIntensity:1})]}),e.jsxs("mesh",{position:[-.1,.82,.3],children:[e.jsx("sphereGeometry",{args:[.06,8,8]}),e.jsx("meshStandardMaterial",{color:"#FF0000",emissive:"#FF0000",emissiveIntensity:1})]}),e.jsxs("mesh",{position:[0,.95,0],castShadow:!0,children:[e.jsx("sphereGeometry",{args:[.35,16,16,0,Math.PI*2,0,Math.PI/2]}),e.jsx("meshStandardMaterial",{color:"#4A4A4A",metalness:.9,roughness:.1})]}),e.jsxs("mesh",{position:[0,1.15,0],children:[e.jsx("octahedronGeometry",{args:[.15]}),e.jsx("meshStandardMaterial",{color:l,emissive:l,emissiveIntensity:1,transparent:!0,opacity:.8})]}),s>=3&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[.2,1.1,0],rotation:[0,0,.3],children:[e.jsx("coneGeometry",{args:[.05,.3,4]}),e.jsx("meshStandardMaterial",{color:"#FFD700",metalness:.8})]}),e.jsxs("mesh",{position:[-.2,1.1,0],rotation:[0,0,-.3],children:[e.jsx("coneGeometry",{args:[.05,.3,4]}),e.jsx("meshStandardMaterial",{color:"#FFD700",metalness:.8})]})]}),e.jsxs("mesh",{position:[0,.3,0],castShadow:!0,children:[e.jsx("sphereGeometry",{args:[.4,16,16]}),e.jsx("meshStandardMaterial",{color:l})]}),e.jsxs("mesh",{position:[0,.35,.15],children:[e.jsx("sphereGeometry",{args:[.3,12,12]}),e.jsx("meshStandardMaterial",{color:"#4A4A4A",metalness:.8,roughness:.2})]}),e.jsxs("group",{position:[.45,.4,0],children:[e.jsxs("mesh",{position:[0,-.2,0],castShadow:!0,children:[e.jsx("capsuleGeometry",{args:[.12,.35,4,8]}),e.jsx("meshStandardMaterial",{color:l})]}),e.jsxs("mesh",{position:[0,-.45,0],children:[e.jsx("sphereGeometry",{args:[.15,8,8]}),e.jsx("meshStandardMaterial",{color:"#FFDAB9"})]})]}),e.jsxs("group",{position:[-.45,.4,0],children:[e.jsxs("mesh",{position:[0,-.2,0],castShadow:!0,children:[e.jsx("capsuleGeometry",{args:[.12,.35,4,8]}),e.jsx("meshStandardMaterial",{color:l})]}),e.jsxs("mesh",{position:[0,-.45,0],children:[e.jsx("sphereGeometry",{args:[.15,8,8]}),e.jsx("meshStandardMaterial",{color:"#FFDAB9"})]})]}),e.jsx("group",{position:[.15,-.1,0],children:e.jsxs("mesh",{position:[0,-.15,0],castShadow:!0,children:[e.jsx("capsuleGeometry",{args:[.1,.2,4,8]}),e.jsx("meshStandardMaterial",{color:l})]})}),e.jsx("group",{position:[-.15,-.1,0],children:e.jsxs("mesh",{position:[0,-.15,0],castShadow:!0,children:[e.jsx("capsuleGeometry",{args:[.1,.2,4,8]}),e.jsx("meshStandardMaterial",{color:l})]})}),n.bossPhase&&n.bossPhase>=2&&e.jsxs("mesh",{position:[0,.5,0],children:[e.jsx("sphereGeometry",{args:[.8,16,16]}),e.jsx("meshBasicMaterial",{color:l,transparent:!0,opacity:.2,side:ke})]}),n.state==="stunned"&&e.jsx("group",{position:[0,1.5,0],children:[0,1,2,3,4].map(h=>e.jsxs("mesh",{position:[Math.cos(h/5*Math.PI*2+a.current*2)*.5,0,Math.sin(h/5*Math.PI*2+a.current*2)*.5],children:[e.jsx("octahedronGeometry",{args:[.1]}),e.jsx("meshStandardMaterial",{color:"#FFFF00",emissive:"#FFFF00",emissiveIntensity:.5})]},h))})]})},rt=(s,n)=>{const t=fe[s];return{id:`boss-${s}`,type:"black",position:n.clone(),rotation:new $(0,0,0),velocity:new x,state:"idle",health:t.maxHealth,maxHealth:t.maxHealth,stunTime:0,alertLevel:1,targetPosition:null,patrolPoints:[],currentPatrolIndex:0,isBoss:!0,bossPhase:1,name:t.name,phase:1,maxPhase:s===5?3:2,attackPattern:t.attacks,currentAttack:"",attackCooldown:0,isInvulnerable:!1,specialAbility:t.attacks[0]}},at={net:"ğŸ¥…",rod:"âš¡",booster:"ğŸš€",hover:"ğŸ›¸",radar:"ğŸ“¡"},it=()=>{const{player:s,monkeys:n,gameTime:t,boss:r,currentStage:o,stages:a,updatePlayer:i}=D(),c=a.find(m=>m.id===o),l=n.filter(m=>m.state==="captured").length,u=n.length,h=s.health/s.maxHealth*100,d=m=>{i({currentTool:m}),console.log("Tool selected:",m)};return e.jsxs("div",{className:"hud",children:[e.jsx("div",{className:"health-bar",children:e.jsx("div",{className:"health-bar-fill",style:{width:`${h}%`,background:h>50?"linear-gradient(90deg, #4CAF50 0%, #8BC34A 100%)":h>25?"linear-gradient(90deg, #FF9800 0%, #FFC107 100%)":"linear-gradient(90deg, #f44336 0%, #FF5722 100%)"}})}),e.jsxs("div",{className:"monkey-counter",children:[e.jsx("span",{className:"monkey-icon",children:"ğŸµ"}),e.jsxs("span",{children:[l," / ",u]})]}),e.jsxs("div",{className:"timer",children:["â±ï¸ ",xe(t)]}),r&&r.state!=="captured"&&e.jsxs("div",{className:"boss-health",children:[e.jsx("div",{className:"boss-name",children:r.name}),e.jsx("div",{className:"boss-health-bar",children:e.jsx("div",{className:"boss-health-fill",style:{width:`${r.health/r.maxHealth*100}%`}})})]}),e.jsx("div",{className:"tool-bar",children:s.tools.map((m,g)=>e.jsxs("div",{className:`tool-item ${s.currentTool===m.type?"active":""}`,title:m.description,onClick:()=>d(m.type),onTouchEnd:f=>{f.preventDefault(),d(m.type)},children:[e.jsx("span",{className:"tool-icon",children:at[m.type]}),e.jsx("span",{className:"tool-key",children:g+1})]},m.type))}),e.jsx("div",{className:"minimap",children:e.jsxs("div",{className:"minimap-inner",children:[e.jsx("div",{className:"minimap-player"}),n.filter(m=>m.state!=="captured").map(m=>{const g=(m.position.x-s.position.x)/50*60+75,f=(m.position.z-s.position.z)/50*60+75;return g<0||g>150||f<0||f>150?null:e.jsx("div",{className:"minimap-monkey",style:{left:`${g}px`,top:`${f}px`,background:m.alertLevel>.5?"#FF0000":"#FFD700"}},m.id)}),r&&r.state!=="captured"&&e.jsx("div",{className:"minimap-monkey",style:{left:`${(r.position.x-s.position.x)/50*60+75}px`,top:`${(r.position.z-s.position.z)/50*60+75}px`,width:"12px",height:"12px",background:"#FF0000",boxShadow:"0 0 5px #FF0000"}})]})}),e.jsx("div",{className:"crosshair"}),e.jsxs("div",{style:{position:"absolute",top:"20px",left:"50%",transform:"translateX(-50%)",background:"rgba(0, 0, 0, 0.7)",padding:"8px 20px",borderRadius:"20px",color:"white",fontSize:"16px",fontWeight:"bold"},children:["Stage ",o,": ",c==null?void 0:c.name]})]})},lt=()=>{const{gameState:s,setGameState:n,setCurrentStage:t,stages:r,loadGame:o}=D(),[a,i]=p.useState(!1),[c,l]=p.useState(!1);V.useEffect(()=>{o()},[o]);const u=()=>{console.log("Game start button clicked"),t(1),console.log("Stage set to 1"),n("playing"),console.log("Game state set to playing")},h=d=>{console.log("Stage select clicked:",d);const m=r.find(g=>g.id===d);m!=null&&m.unlocked?(t(d),console.log("Stage set to:",d),n("playing"),console.log("Game state set to playing")):console.log("Stage is locked:",d)};return s!=="menu"?null:e.jsx("div",{className:"menu-overlay",children:!a&&!c?e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"game-title",children:"ğŸµ ãƒ¢ãƒ³ã‚­ãƒ¼ã‚­ãƒ£ãƒƒãƒãƒ£ãƒ¼ ğŸµ"}),e.jsx("p",{style:{color:"white",marginBottom:"30px",fontSize:"18px"},children:"é€ƒã’ã‚‹çŒ¿ãŸã¡ã‚’æ•ã¾ãˆã¦å¹³å’Œã‚’å–ã‚Šæˆ»ã›ï¼"}),e.jsx("button",{className:"menu-button",onClick:u,children:"ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ"}),e.jsx("button",{className:"menu-button secondary",onClick:()=>l(!0),children:"ã‚¹ãƒ†ãƒ¼ã‚¸ã‚»ãƒ¬ã‚¯ãƒˆ"}),e.jsx("button",{className:"menu-button secondary",onClick:()=>i(!0),children:"æ“ä½œæ–¹æ³•"})]}):a?e.jsxs("div",{className:"instructions",children:[e.jsx("h2",{children:"ğŸ® æ“ä½œæ–¹æ³•"}),e.jsxs("div",{className:"instructions-grid",children:[e.jsxs("div",{className:"instruction-item",children:[e.jsx("span",{className:"key",children:"W A S D"}),e.jsx("span",{children:"ç§»å‹•"})]}),e.jsxs("div",{className:"instruction-item",children:[e.jsx("span",{className:"key",children:"ãƒã‚¦ã‚¹"}),e.jsx("span",{children:"ã‚«ãƒ¡ãƒ©æ“ä½œ"})]}),e.jsxs("div",{className:"instruction-item",children:[e.jsx("span",{className:"key",children:"ã‚¹ãƒšãƒ¼ã‚¹"}),e.jsx("span",{children:"ã‚¸ãƒ£ãƒ³ãƒ—"})]}),e.jsxs("div",{className:"instruction-item",children:[e.jsx("span",{className:"key",children:"Shift"}),e.jsx("span",{children:"ãƒ€ãƒƒã‚·ãƒ¥"})]}),e.jsxs("div",{className:"instruction-item",children:[e.jsx("span",{className:"key",children:"å·¦ã‚¯ãƒªãƒƒã‚¯"}),e.jsx("span",{children:"æ”»æ’ƒ / æ•ç²"})]}),e.jsxs("div",{className:"instruction-item",children:[e.jsx("span",{className:"key",children:"1 - 5"}),e.jsx("span",{children:"ãƒ„ãƒ¼ãƒ«åˆ‡ã‚Šæ›¿ãˆ"})]}),e.jsxs("div",{className:"instruction-item",children:[e.jsx("span",{className:"key",children:"ESC"}),e.jsx("span",{children:"ãƒãƒ¼ã‚º"})]})]}),e.jsx("h3",{style:{color:"#f5a623",marginTop:"20px",marginBottom:"10px"},children:"ğŸ”§ ãƒ„ãƒ¼ãƒ«èª¬æ˜"}),e.jsxs("ul",{style:{textAlign:"left",lineHeight:"1.8"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"ğŸ¥… ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ¼ãƒãƒƒãƒˆ:"})," æ°—çµ¶ã—ãŸçŒ¿ã‚’æ•ç²"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"âš¡ ã‚¹ã‚¿ãƒ³ãƒ­ãƒƒãƒ‰:"})," çŒ¿ã‚’æ°—çµ¶ã•ã›ã‚‹"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"ğŸš€ ãƒ–ãƒ¼ã‚¹ã‚¿ãƒ¼:"})," é«˜é€Ÿãƒ€ãƒƒã‚·ãƒ¥"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"ğŸ›¸ ãƒ›ãƒãƒ¼ãƒ‰ãƒ­ãƒ¼ãƒ³:"})," ç©ºä¸­æµ®éŠ"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"ğŸ“¡ ãƒ¬ãƒ¼ãƒ€ãƒ¼ã‚¹ã‚­ãƒ£ãƒŠãƒ¼:"})," éš ã‚ŒãŸçŒ¿ã‚’æ¢çŸ¥"]})]}),e.jsx("button",{className:"menu-button",onClick:()=>i(!1),style:{marginTop:"20px"},children:"æˆ»ã‚‹"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{style:{color:"white",marginBottom:"30px"},children:"ã‚¹ãƒ†ãƒ¼ã‚¸ã‚»ãƒ¬ã‚¯ãƒˆ"}),e.jsx("div",{className:"stage-select",children:r.map(d=>e.jsxs("div",{className:`stage-card ${d.unlocked?"":"locked"}`,onClick:()=>h(d.id),children:[e.jsx("div",{className:"stage-number",children:d.unlocked?d.id:"ğŸ”’"}),e.jsx("div",{className:"stage-name",children:d.name}),d.unlocked&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"stage-status",children:d.cleared?"âœ… ã‚¯ãƒªã‚¢æ¸ˆã¿":"â­• æœªã‚¯ãƒªã‚¢"}),d.bestRank&&e.jsxs("div",{style:{color:"#FFD700",marginTop:"5px"},children:["ãƒ™ã‚¹ãƒˆ: ",d.bestRank,"ãƒ©ãƒ³ã‚¯"]})]})]},d.id))}),e.jsx("button",{className:"menu-button secondary",onClick:()=>l(!1),style:{marginTop:"20px"},children:"æˆ»ã‚‹"})]})})},ct=()=>{const{gameState:s,setGameState:n}=D();return s!=="paused"?null:e.jsxs("div",{className:"pause-overlay",children:[e.jsx("h2",{className:"pause-title",children:"â¸ï¸ ãƒãƒ¼ã‚º"}),e.jsx("button",{className:"menu-button",onClick:()=>n("playing"),children:"ã‚²ãƒ¼ãƒ ã«æˆ»ã‚‹"}),e.jsx("button",{className:"menu-button secondary",onClick:()=>n("menu"),children:"ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹"})]})},dt=()=>{const{gameState:s,setGameState:n,updateSettings:t}=D(),[r,o]=p.useState(0),a=[{title:"ã‚ˆã†ã“ãï¼",content:"ãƒ¢ãƒ³ã‚­ãƒ¼ã‚­ãƒ£ãƒƒãƒãƒ£ãƒ¼ã¸ã‚ˆã†ã“ãï¼ã“ã®ã‚²ãƒ¼ãƒ ã§ã¯ã€çŸ¥èƒ½å¢—å¹…ãƒ˜ãƒ«ãƒ¡ãƒƒãƒˆã‚’è¢«ã£ãŸçŒ¿ãŸã¡ã‚’æ•ã¾ãˆã¾ã™ã€‚"},{title:"ç§»å‹•æ–¹æ³•",content:"WASDã‚­ãƒ¼ã§ç§»å‹•ã€ãƒã‚¦ã‚¹ã§ã‚«ãƒ¡ãƒ©ã‚’æ“ä½œã—ã¾ã™ã€‚ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã§ã‚¸ãƒ£ãƒ³ãƒ—ã€Shiftã‚­ãƒ¼ã§ãƒ€ãƒƒã‚·ãƒ¥ã§ãã¾ã™ã€‚"},{title:"çŒ¿ã®æ•ã¾ãˆæ–¹",content:"ã¾ãšã€Œã‚¹ã‚¿ãƒ³ãƒ­ãƒƒãƒ‰ã€ã§çŒ¿ã‚’æ°—çµ¶ã•ã›ã€ãã®å¾Œã€Œã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ¼ãƒãƒƒãƒˆã€ã§æ•ç²ã—ã¾ã™ã€‚æ•°å­—ã‚­ãƒ¼ã§ãƒ„ãƒ¼ãƒ«ã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã—ã‚‡ã†ã€‚"},{title:"æº–å‚™å®Œäº†ï¼",content:"ã™ã¹ã¦ã®çŒ¿ã‚’æ•ã¾ãˆã¦ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ã‚‡ã†ã€‚é ‘å¼µã£ã¦ï¼"}];if(s!=="tutorial")return null;const i=()=>{r<a.length-1?o(r+1):(t({showTutorial:!1}),n("playing"))};return e.jsx("div",{className:"tutorial-overlay",children:e.jsxs("div",{className:"tutorial-box",children:[e.jsx("h3",{children:a[r].title}),e.jsx("p",{children:a[r].content}),e.jsx("button",{className:"menu-button",onClick:i,children:r<a.length-1?"æ¬¡ã¸":"ã‚²ãƒ¼ãƒ é–‹å§‹ï¼"}),e.jsxs("div",{style:{marginTop:"15px",color:"#888"},children:[r+1," / ",a.length]})]})})},ut=()=>{var g;const{gameState:s,setGameState:n,result:t,saveGame:r,currentStage:o,setCurrentStage:a,stages:i}=D();if(s!=="result"||!t)return null;const c=()=>{r(),window.location.reload()},l=()=>{r(),o<5?(a(o+1),window.location.reload()):n("menu")},u=()=>{r(),n("menu")},h=f=>{switch(f){case"S":return"rank-s";case"A":return"rank-a";case"B":return"rank-b";default:return"rank-c"}},d=f=>{switch(f){case"S":return"ğŸ† ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼ç´ æ™´ã‚‰ã—ã„ï¼ ğŸ†";case"A":return"â­ ã‚°ãƒ¬ãƒ¼ãƒˆï¼ã‚ˆãã‚„ã£ãŸï¼ â­";case"B":return"ğŸ‘ ã‚°ãƒƒãƒ‰ï¼ãã®èª¿å­ï¼ ğŸ‘";default:return"âœ… ã‚¯ãƒªã‚¢ï¼ãŠã‚ã§ã¨ã†ï¼ âœ…"}},m=o<5&&((g=i.find(f=>f.id===o+1))==null?void 0:g.unlocked);return e.jsxs("div",{className:"result-overlay",children:[e.jsx("h1",{className:"result-title",children:t.cleared?"ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢ï¼":"ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼"}),t.cleared&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`result-rank ${h(t.rank)}`,children:t.rank}),e.jsx("p",{style:{color:"white",fontSize:"20px",marginBottom:"20px"},children:d(t.rank)})]}),e.jsxs("div",{className:"result-stats",children:["ğŸµ æ•ç²æ•°: ",t.capturedCount," / ",t.totalMonkeys]}),e.jsxs("div",{className:"result-stats",children:["â±ï¸ ã‚¯ãƒªã‚¢ã‚¿ã‚¤ãƒ : ",xe(t.clearTime)]}),e.jsxs("div",{className:"result-stats",children:["ğŸ’” å—ã‘ãŸãƒ€ãƒ¡ãƒ¼ã‚¸: ",t.damageTaken]}),e.jsxs("div",{style:{marginTop:"40px",display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[t.cleared&&m&&e.jsx("button",{className:"menu-button",onClick:l,children:"æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¸"}),e.jsx("button",{className:"menu-button secondary",onClick:c,children:"ã‚‚ã†ä¸€åº¦"}),e.jsx("button",{className:"menu-button secondary",onClick:u,children:"ã‚¿ã‚¤ãƒˆãƒ«ã¸"})]}),e.jsxs("div",{style:{marginTop:"40px",padding:"20px",background:"rgba(0, 0, 0, 0.5)",borderRadius:"10px",color:"white"},children:[e.jsx("h3",{style:{marginBottom:"10px"},children:"ãƒ©ãƒ³ã‚¯è©•ä¾¡åŸºæº–"}),e.jsx("p",{children:"ğŸ† S: 3åˆ†ä»¥å†… & ãƒãƒ¼ãƒ€ãƒ¡ãƒ¼ã‚¸"}),e.jsx("p",{children:"â­ A: 5åˆ†ä»¥å†… & ãƒ€ãƒ¡ãƒ¼ã‚¸30ä»¥ä¸‹"}),e.jsx("p",{children:"ğŸ‘ B: 10åˆ†ä»¥å†…"}),e.jsx("p",{children:"âœ… C: ã‚¯ãƒªã‚¢"})]})]})},pt=()=>{const{notification:s,setNotification:n}=D();return V.useEffect(()=>{if(s){const t=setTimeout(()=>{n(null)},2e3);return()=>clearTimeout(t)}},[s,n]),s?e.jsx("div",{className:"notification",children:s}):null},ht=()=>{const{showDamageFlash:s,setShowDamageFlash:n}=D();return V.useEffect(()=>{if(s){const t=setTimeout(()=>{n(!1)},200);return()=>clearTimeout(t)}},[s,n]),s?e.jsx("div",{className:"damage-flash"}):null},mt=()=>{const{gameState:s}=D();return s!=="loading"?null:e.jsxs("div",{className:"loading-screen",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("div",{className:"loading-text",children:"Loading..."})]})},xt=({show:s,onComplete:n})=>{const[t,r]=p.useState(!1);return p.useEffect(()=>{if(s){r(!0);const o=setTimeout(()=>{r(!1),n()},1500);return()=>clearTimeout(o)}},[s,n]),t?e.jsxs("div",{style:{position:"absolute",top:"40%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1e3,pointerEvents:"none"},children:[e.jsx("div",{className:"capture-text",style:{fontSize:"80px",fontWeight:"bold",color:"#FFD700",textShadow:"4px 4px 8px rgba(0, 0, 0, 0.8), 0 0 20px #FFA500",animation:"capturePopIn 0.5s ease-out, capturePulse 1s ease-in-out infinite",textAlign:"center"},children:"GET!"}),e.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:[...Array(8)].map((o,a)=>e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"20px",height:"20px",background:"radial-gradient(circle, #FFD700 0%, transparent 70%)",borderRadius:"50%",animation:`sparkle 1s ease-out ${a*.1}s`,transform:`rotate(${a*45}deg) translateY(-80px)`}},a))}),e.jsx("style",{children:`
          @keyframes capturePopIn {
            0% {
              transform: translate(-50%, -50%) scale(0);
              opacity: 0;
            }
            50% {
              transform: translate(-50%, -50%) scale(1.3);
            }
            100% {
              transform: translate(-50%, -50%) scale(1);
              opacity: 1;
            }
          }
          
          @keyframes capturePulse {
            0%, 100% {
              transform: translate(-50%, -50%) scale(1);
            }
            50% {
              transform: translate(-50%, -50%) scale(1.1);
            }
          }
          
          @keyframes sparkle {
            0% {
              opacity: 1;
              transform: rotate(calc(var(--rotation, 0deg))) translateY(-40px) scale(0);
            }
            50% {
              opacity: 1;
              transform: rotate(calc(var(--rotation, 0deg))) translateY(-120px) scale(1);
            }
            100% {
              opacity: 0;
              transform: rotate(calc(var(--rotation, 0deg))) translateY(-160px) scale(0.5);
            }
          }
        `})]}):null},ft=({show:s,bossName:n,onComplete:t})=>{const[r,o]=p.useState(!1);return p.useEffect(()=>{if(s){o(!0);const a=setTimeout(()=>{o(!1),t()},3e3);return()=>clearTimeout(a)}},[s,t]),r?e.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.8)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:2e3,pointerEvents:"none"},children:[e.jsx("div",{style:{fontSize:"60px",fontWeight:"bold",color:"#FF0000",textShadow:"0 0 20px #FF0000, 4px 4px 8px rgba(0, 0, 0, 0.8)",marginBottom:"40px",animation:"warningFlash 0.5s ease-in-out infinite"},children:"âš ï¸ WARNING âš ï¸"}),e.jsx("div",{style:{fontSize:"80px",fontWeight:"bold",color:"#FFD700",textShadow:"4px 4px 8px rgba(0, 0, 0, 0.8), 0 0 30px #FFA500",marginBottom:"20px",animation:"bossSlideIn 1s ease-out",letterSpacing:"10px"},children:"BOSS BATTLE"}),e.jsx("div",{style:{fontSize:"50px",fontWeight:"bold",color:"#FFFFFF",textShadow:"3px 3px 6px rgba(0, 0, 0, 0.8)",animation:"bossFadeIn 1.5s ease-out"},children:n}),e.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",overflow:"hidden"},children:[...Array(4)].map((a,i)=>e.jsx("div",{style:{position:"absolute",left:`${20+i*20}%`,top:0,width:"4px",height:"100%",background:"linear-gradient(to bottom, transparent, #FFD700, transparent)",animation:`lightning 0.3s ease-in-out ${i*.2}s infinite`}},i))}),e.jsx("style",{children:`
          @keyframes warningFlash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
          }
          
          @keyframes bossSlideIn {
            0% {
              transform: translateX(-100%);
              opacity: 0;
            }
            100% {
              transform: translateX(0);
              opacity: 1;
            }
          }
          
          @keyframes bossFadeIn {
            0% {
              transform: scale(0.5);
              opacity: 0;
            }
            100% {
              transform: scale(1);
              opacity: 1;
            }
          }
          
          @keyframes lightning {
            0%, 100% {
              opacity: 0;
            }
            50% {
              opacity: 0.8;
            }
          }
        `})]}):null},gt=()=>{const{monkeys:s,boss:n,currentStage:t,gameState:r}=D();return $e(),r!=="playing"&&r!=="paused"?null:e.jsxs(e.Fragment,{children:[e.jsx("ambientLight",{intensity:.5}),e.jsx("directionalLight",{position:[50,50,25],intensity:1,castShadow:!0,"shadow-mapSize":[2048,2048],"shadow-camera-far":150,"shadow-camera-left":-50,"shadow-camera-right":50,"shadow-camera-top":50,"shadow-camera-bottom":-50}),e.jsx("hemisphereLight",{args:["#87CEEB","#3d5c3d",.3]}),e.jsx(Se,{distance:45e4,sunPosition:[100,50,100],inclination:.5,azimuth:.25}),e.jsx("fog",{attach:"fog",args:["#87CEEB",30,100]}),e.jsx(qe,{stageId:t}),e.jsx(Ke,{}),s.map(o=>e.jsx(We,{data:o},o.id)),n&&e.jsx(ot,{stageId:t,bossData:n})]})},yt=()=>{const{currentStage:s,setMonkeys:n,setBoss:t,resetPlayer:r,setGameTime:o,gameState:a}=D();p.useEffect(()=>{if(a==="playing"){r(),o(0);const c=Ze(s).map(h=>{const d=Ue(h.position,4,5);return He(h.type,h.position,d)});n(c);const l=new x(0,1,-30),u=rt(s,l);t(u)}},[s,a,n,t,r,o])},jt=()=>{const{gameState:s,camera:n,player:t,boss:r,monkeys:o}=D(),[a,i]=V.useState(!0),[c,l]=V.useState(!1),[u,h]=V.useState(!1),d=p.useRef(0),m=p.useRef(!1);p.useEffect(()=>{const S=document.createElement("canvas");S.getContext("webgl")||S.getContext("experimental-webgl")?console.log("WebGL is supported"):(i(!1),console.error("WebGL is not supported on this device"))},[]),p.useEffect(()=>{t.capturedMonkeys>d.current&&(l(!0),d.current=t.capturedMonkeys)},[t.capturedMonkeys]),p.useEffect(()=>{const S=o.filter(E=>E.state!=="captured");s==="playing"&&r&&S.length===0&&!m.current&&(h(!0),m.current=!0)},[r,o,s]),p.useEffect(()=>{s==="menu"&&(m.current=!1)},[s]),Pe(),De(),yt(),p.useEffect(()=>{console.log("Game state changed:",s)},[s]);const g=p.useMemo(()=>[n.position.x,n.position.y,n.position.z],[n.position]),f=p.useMemo(()=>[t.position.x,t.position.y+1,t.position.z],[t.position]);return a?e.jsxs("div",{className:"game-container",children:[(s==="playing"||s==="paused")&&e.jsx(me,{shadows:!0,camera:{position:g,fov:75,near:.1,far:1e3},onCreated:({camera:S,gl:E,size:L})=>{S.lookAt(...f),E.setPixelRatio(Math.min(window.devicePixelRatio,2)),console.log("Canvas created",{canvasWidth:E.domElement.width,canvasHeight:E.domElement.height,sizeWidth:L.width,sizeHeight:L.height,devicePixelRatio:window.devicePixelRatio,windowSize:`${window.innerWidth}x${window.innerHeight}`,glInfo:E.getContextAttributes()})},style:{width:"100vw",height:"100vh",position:"absolute",top:0,left:0,display:"block",background:"#1a1a2e",touchAction:"none",zIndex:10},gl:{antialias:!1,alpha:!1,powerPreference:"high-performance",preserveDrawingBuffer:!0},children:e.jsx(p.Suspense,{fallback:null,children:e.jsx(gt,{})})}),(s==="playing"||s==="paused")&&e.jsx(it,{}),e.jsx(lt,{}),e.jsx(ct,{}),e.jsx(dt,{}),e.jsx(ut,{}),e.jsx(pt,{}),e.jsx(ht,{}),e.jsx(mt,{}),e.jsx(xt,{show:c,onComplete:()=>l(!1)}),e.jsx(ft,{show:u,bossName:(r==null?void 0:r.name)||"BOSS",onComplete:()=>h(!1)}),(s==="playing"||s==="paused")&&e.jsxs(e.Fragment,{children:[e.jsx(Ft,{}),e.jsx(St,{})]})]}):e.jsxs("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",color:"white",padding:"20px",textAlign:"center"},children:[e.jsx("h2",{children:"âš ï¸ WebGLãŒåˆ©ç”¨ã§ãã¾ã›ã‚“"}),e.jsx("p",{children:"ã“ã®ã‚²ãƒ¼ãƒ ã‚’éŠã¶ã«ã¯WebGLã«å¯¾å¿œã—ãŸãƒ–ãƒ©ã‚¦ã‚¶ãŒå¿…è¦ã§ã™ã€‚"})]})},Ft=()=>{const{updateInput:s}=D(),n=p.useRef(null),t=p.useRef(null),[r,o]=V.useState(!1),a=p.useRef(null),i=h=>{const d=h.touches[0];a.current=d.identifier,o(!0),u(d.clientX,d.clientY)},c=h=>{const d=Array.from(h.touches).find(m=>m.identifier===a.current);d&&u(d.clientX,d.clientY)},l=()=>{a.current=null,o(!1),s({forward:!1,backward:!1,left:!1,right:!1}),t.current&&(t.current.style.transform="translate(-50%, -50%)")},u=(h,d)=>{if(!n.current||!t.current)return;const m=n.current.getBoundingClientRect(),g=m.left+m.width/2,f=m.top+m.height/2,S=h-g,E=d-f,L=Math.sqrt(S*S+E*E),v=m.width/2-30,Y=Math.min(L,v),U=Math.atan2(E,S),z=Math.cos(U)*Y,M=Math.sin(U)*Y;t.current.style.transform=`translate(calc(-50% + ${z}px), calc(-50% + ${M}px))`;const H=v*.3,B=S/v,C=E/v;s({forward:C<-H/v,backward:C>H/v,left:B<-H/v,right:B>H/v})};return e.jsx("div",{className:"touch-controls",children:e.jsx("div",{ref:n,className:"virtual-joystick",onTouchStart:i,onTouchMove:c,onTouchEnd:l,style:{opacity:r?1:.7},children:e.jsx("div",{ref:t,className:"joystick-knob"})})})},St=()=>{const{updateInput:s,updatePlayer:n}=D(),t=()=>{s({attack:!0}),n({isAttacking:!0}),console.log("Attack button pressed"),setTimeout(()=>{s({attack:!1}),n({isAttacking:!1})},100)},r=()=>{s({jump:!0}),console.log("Jump button pressed"),setTimeout(()=>{s({jump:!1})},100)};return e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"action-btn jump",onTouchStart:o=>{o.preventDefault(),r()},children:"â¬†ï¸"}),e.jsx("button",{className:"action-btn",onTouchStart:o=>{o.preventDefault(),t()},children:"ğŸ¯"})]})},ue=({machine:s,isPlayer:n=!1})=>{const t=p.useRef(null),r=p.useRef([]),o=p.useRef(null),a=p.useRef(0);K((l,u)=>{if(!t.current)return;a.current+=u,t.current.position.copy(s.position),t.current.rotation.copy(s.rotation);const h=s.speed*.1;if(r.current.forEach(d=>{d&&(d.rotation.x+=h*u)}),o.current){const d=s.currentForm==="long"?1.5:1,m=s.currentForm==="long"?.8:1;o.current.scale.z=ee.lerp(o.current.scale.z,d,u*5),o.current.scale.x=ee.lerp(o.current.scale.x,m,u*5)}if(s.isSpinning&&(t.current.rotation.y+=u*15),s.isInvincible?t.current.visible=Math.floor(a.current*10)%2===0:t.current.visible=!0,s.isDrifting&&s.driftDirection){const d=s.driftDirection==="left"?.2:-.2;t.current.rotation.z=ee.lerp(t.current.rotation.z,d,u*5)}else t.current.rotation.z=ee.lerp(t.current.rotation.z,0,u*5)});const c=(()=>{if(!s.isDrifting)return null;switch(s.driftLevel){case 1:return"#FFFFFF";case 2:return"#00BFFF";case 3:return"#FFA500";default:return null}})();return e.jsxs("group",{ref:t,children:[e.jsxs("group",{ref:o,children:[e.jsxs("mesh",{position:[0,.4,0],castShadow:!0,children:[e.jsx("capsuleGeometry",{args:[.4,.6,8,16]}),e.jsx("meshStandardMaterial",{color:s.color})]}),e.jsxs("mesh",{position:[0,1,0],castShadow:!0,children:[e.jsx("sphereGeometry",{args:[.35,16,16]}),e.jsx("meshStandardMaterial",{color:"#F5DEB3"})]}),e.jsxs("mesh",{position:[0,1.15,0],castShadow:!0,children:[e.jsx("sphereGeometry",{args:[.3,16,16,0,Math.PI*2,0,Math.PI/2]}),e.jsx("meshStandardMaterial",{color:"#FF0000"})]}),e.jsxs("mesh",{position:[0,1.35,0],children:[e.jsx("sphereGeometry",{args:[.08,8,8]}),e.jsx("meshStandardMaterial",{color:"#FFFF00",emissive:"#FFFF00",emissiveIntensity:.5})]}),e.jsxs("mesh",{position:[.12,1,.28],children:[e.jsx("sphereGeometry",{args:[.08,8,8]}),e.jsx("meshStandardMaterial",{color:"#000000"})]}),e.jsxs("mesh",{position:[-.12,1,.28],children:[e.jsx("sphereGeometry",{args:[.08,8,8]}),e.jsx("meshStandardMaterial",{color:"#000000"})]}),e.jsxs("mesh",{position:[.35,1,0],castShadow:!0,children:[e.jsx("sphereGeometry",{args:[.12,8,8]}),e.jsx("meshStandardMaterial",{color:"#F5DEB3"})]}),e.jsxs("mesh",{position:[-.35,1,0],castShadow:!0,children:[e.jsx("sphereGeometry",{args:[.12,8,8]}),e.jsx("meshStandardMaterial",{color:"#F5DEB3"})]})]}),e.jsxs("group",{position:[.5,0,.5],children:[e.jsxs("mesh",{ref:l=>{l&&(r.current[0]=l)},rotation:[0,0,Math.PI/2],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.25,.25,.15,16]}),e.jsx("meshStandardMaterial",{color:"#1a1a1a"})]}),e.jsxs("mesh",{rotation:[0,0,Math.PI/2],children:[e.jsx("cylinderGeometry",{args:[.15,.15,.16,8]}),e.jsx("meshStandardMaterial",{color:"#C0C0C0"})]})]}),e.jsxs("group",{position:[-.5,0,.5],children:[e.jsxs("mesh",{ref:l=>{l&&(r.current[1]=l)},rotation:[0,0,Math.PI/2],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.25,.25,.15,16]}),e.jsx("meshStandardMaterial",{color:"#1a1a1a"})]}),e.jsxs("mesh",{rotation:[0,0,Math.PI/2],children:[e.jsx("cylinderGeometry",{args:[.15,.15,.16,8]}),e.jsx("meshStandardMaterial",{color:"#C0C0C0"})]})]}),e.jsxs("group",{position:[.5,0,-.5],children:[e.jsxs("mesh",{ref:l=>{l&&(r.current[2]=l)},rotation:[0,0,Math.PI/2],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.3,.3,.2,16]}),e.jsx("meshStandardMaterial",{color:"#1a1a1a"})]}),e.jsxs("mesh",{rotation:[0,0,Math.PI/2],children:[e.jsx("cylinderGeometry",{args:[.18,.18,.21,8]}),e.jsx("meshStandardMaterial",{color:"#C0C0C0"})]})]}),e.jsxs("group",{position:[-.5,0,-.5],children:[e.jsxs("mesh",{ref:l=>{l&&(r.current[3]=l)},rotation:[0,0,Math.PI/2],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.3,.3,.2,16]}),e.jsx("meshStandardMaterial",{color:"#1a1a1a"})]}),e.jsxs("mesh",{rotation:[0,0,Math.PI/2],children:[e.jsx("cylinderGeometry",{args:[.18,.18,.21,8]}),e.jsx("meshStandardMaterial",{color:"#C0C0C0"})]})]}),e.jsxs("mesh",{position:[0,.3,-.7],castShadow:!0,children:[e.jsx("boxGeometry",{args:[.6,.4,.4]}),e.jsx("meshStandardMaterial",{color:"#404040",metalness:.8,roughness:.2})]}),e.jsxs("mesh",{position:[.25,.2,-.9],rotation:[Math.PI/6,0,0],children:[e.jsx("cylinderGeometry",{args:[.05,.08,.3,8]}),e.jsx("meshStandardMaterial",{color:"#2F2F2F",metalness:.9,roughness:.1})]}),e.jsxs("mesh",{position:[-.25,.2,-.9],rotation:[Math.PI/6,0,0],children:[e.jsx("cylinderGeometry",{args:[.05,.08,.3,8]}),e.jsx("meshStandardMaterial",{color:"#2F2F2F",metalness:.9,roughness:.1})]}),s.isBoosting&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[.25,.2,-1.2],children:[e.jsx("coneGeometry",{args:[.15,.5,8]}),e.jsx("meshBasicMaterial",{color:"#FF4500",transparent:!0,opacity:.8})]}),e.jsxs("mesh",{position:[-.25,.2,-1.2],children:[e.jsx("coneGeometry",{args:[.15,.5,8]}),e.jsx("meshBasicMaterial",{color:"#FF4500",transparent:!0,opacity:.8})]})]}),c&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[.5,0,-.5],children:[e.jsx("sphereGeometry",{args:[.2,8,8]}),e.jsx("meshBasicMaterial",{color:c,transparent:!0,opacity:.6})]}),e.jsxs("mesh",{position:[-.5,0,-.5],children:[e.jsx("sphereGeometry",{args:[.2,8,8]}),e.jsx("meshBasicMaterial",{color:c,transparent:!0,opacity:.6})]})]}),s.isInvincible&&e.jsxs("mesh",{children:[e.jsx("sphereGeometry",{args:[1.2,16,16]}),e.jsx("meshBasicMaterial",{color:"#FFD700",transparent:!0,opacity:.3,side:re})]}),s.currentItem&&e.jsxs("mesh",{position:[0,1.8,0],children:[e.jsx("boxGeometry",{args:[.3,.3,.3]}),e.jsx("meshStandardMaterial",{color:"#00FF00"})]}),n&&e.jsxs("mesh",{position:[0,2.2,0],rotation:[Math.PI,0,0],children:[e.jsx("coneGeometry",{args:[.2,.4,4]}),e.jsx("meshBasicMaterial",{color:"#00FF00"})]})]})},bt=({start:s,end:n,width:t,color:r="#505050"})=>{const o=new x().subVectors(n,s),a=o.length(),i=new x().addVectors(s,n).multiplyScalar(.5),c=Math.atan2(o.x,o.z);return e.jsxs("group",{position:i,rotation:[0,c,0],children:[e.jsxs("mesh",{receiveShadow:!0,position:[0,.01,0],children:[e.jsx("boxGeometry",{args:[t,.1,a]}),e.jsx("meshStandardMaterial",{color:r})]}),e.jsxs("mesh",{position:[t/2-.1,.02,0],children:[e.jsx("boxGeometry",{args:[.2,.1,a]}),e.jsx("meshStandardMaterial",{color:"#FFFFFF"})]}),e.jsxs("mesh",{position:[-(t/2)+.1,.02,0],children:[e.jsx("boxGeometry",{args:[.2,.1,a]}),e.jsx("meshStandardMaterial",{color:"#FFFFFF"})]})]})},wt=({checkpoint:s,isFinishLine:n})=>{const t=p.useRef(null);return K(({clock:r})=>{t.current&&!n&&(t.current.rotation.y=r.getElapsedTime()*.5)}),e.jsx("group",{ref:t,position:s.position,children:n?e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[-8,4,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.3,.3,8,8]}),e.jsx("meshStandardMaterial",{color:"#FFFFFF"})]}),e.jsxs("mesh",{position:[8,4,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.3,.3,8,8]}),e.jsx("meshStandardMaterial",{color:"#FFFFFF"})]}),e.jsxs("mesh",{position:[0,8,0],rotation:[0,0,Math.PI/2],children:[e.jsx("cylinderGeometry",{args:[.3,.3,16,8]}),e.jsx("meshStandardMaterial",{color:"#FF0000"})]}),e.jsxs("mesh",{position:[0,7,.1],children:[e.jsx("planeGeometry",{args:[14,1.5]}),e.jsx("meshBasicMaterial",{color:"#000000"})]}),Array.from({length:14}).map((r,o)=>Array.from({length:3}).map((a,i)=>(o+i)%2===0?e.jsxs("mesh",{position:[-6.5+o,6.5+i*.5,.15],children:[e.jsx("planeGeometry",{args:[1,.5]}),e.jsx("meshBasicMaterial",{color:"#FFFFFF"})]},`${o}-${i}`):null))]}):e.jsxs("mesh",{children:[e.jsx("torusGeometry",{args:[4,.2,8,24]}),e.jsx("meshStandardMaterial",{color:"#00FF00",transparent:!0,opacity:.3})]})})},Mt=({itemBox:s})=>{const n=p.useRef(null);return K(({clock:t})=>{n.current&&s.isActive&&(n.current.rotation.y=t.getElapsedTime()*2,n.current.rotation.x=Math.sin(t.getElapsedTime()*3)*.2,n.current.position.y=s.position.y+Math.sin(t.getElapsedTime()*2)*.3)}),s.isActive?e.jsxs("mesh",{ref:n,position:s.position,castShadow:!0,children:[e.jsx("boxGeometry",{args:[1.5,1.5,1.5]}),e.jsx("meshStandardMaterial",{color:"#FFD700",emissive:"#FF8C00",emissiveIntensity:.3,transparent:!0,opacity:.9})]}):null},kt=()=>{const s=[],n=[];for(let i=0;i<40;i++){const c=i/40*Math.PI*2,l=Math.cos(c)*80,u=Math.sin(c)*50;s.push(new x(l,0,u)),i%10===0&&n.push({id:`checkpoint-${n.length}`,position:new x(l,0,u),width:16,rotation:new $(0,-c+Math.PI/2,0),order:n.length})}const a=[];for(let i=0;i<20;i++){const c=i/20*Math.PI*2,l=(i%3-1)*3,u=Math.cos(c)*(80+l),h=Math.sin(c)*(50+l*(50/80));a.push({id:`item-${i}`,position:new x(u,1.5,h),isActive:!0,respawnTime:10})}return{id:"monkey-park-circuit",name:"ãƒ¢ãƒ³ã‚­ãƒ¼ãƒ‘ãƒ¼ã‚¯ãƒ»ã‚µãƒ¼ã‚­ãƒƒãƒˆ",cup:"monkey",laps:3,waypoints:s,checkpoints:n,itemBoxes:a,obstacles:[],startPosition:new x(0,0,55),startRotation:new $(0,0,0),environment:"park"}},vt=({courseData:s,onItemBoxCollected:n})=>{const t=p.useMemo(()=>{const r=[];for(let o=0;o<s.waypoints.length;o++){const a=s.waypoints[o],i=s.waypoints[(o+1)%s.waypoints.length];r.push({start:a,end:i})}return r},[s.waypoints]);return e.jsxs("group",{children:[e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.1,0],receiveShadow:!0,children:[e.jsx("planeGeometry",{args:[500,500]}),e.jsx("meshStandardMaterial",{color:"#228B22"})]}),t.map((r,o)=>e.jsx(bt,{start:r.start,end:r.end,width:14,color:o===0?"#707070":"#505050"},o)),s.checkpoints.map((r,o)=>e.jsx(wt,{checkpoint:r,isFinishLine:o===0},r.id)),s.itemBoxes.map(r=>e.jsx(Mt,{itemBox:r,onCollected:()=>n==null?void 0:n(r)},r.id)),Array.from({length:50}).map((r,o)=>{const a=o/50*Math.PI*2,i=100+Math.random()*30,c=Math.cos(a)*i,l=Math.sin(a)*i,u=5+Math.random()*5;return e.jsxs("group",{position:[c,0,l],children:[e.jsxs("mesh",{position:[0,u/4,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.3,.5,u/2,8]}),e.jsx("meshStandardMaterial",{color:"#8B4513"})]}),e.jsxs("mesh",{position:[0,u/2+2,0],castShadow:!0,children:[e.jsx("coneGeometry",{args:[3,6,8]}),e.jsx("meshStandardMaterial",{color:"#228B22"})]})]},`tree-${o}`)}),Array.from({length:20}).map((r,o)=>{const a=o/20*Math.PI*2+.1,i=95+Math.random()*10,c=Math.cos(a)*i,l=Math.sin(a)*i;return e.jsxs("group",{position:[c,0,l],children:[e.jsxs("mesh",{position:[0,3,0],castShadow:!0,children:[e.jsx("cylinderGeometry",{args:[.4,.6,6,8]}),e.jsx("meshStandardMaterial",{color:"#8B7355"})]}),Array.from({length:6}).map((u,h)=>e.jsxs("mesh",{position:[Math.cos(h/6*Math.PI*2)*2,5.5,Math.sin(h/6*Math.PI*2)*2],rotation:[Math.PI/4,h/6*Math.PI*2,0],children:[e.jsx("boxGeometry",{args:[.5,.1,3]}),e.jsx("meshStandardMaterial",{color:"#32CD32"})]},h))]},`banana-tree-${o}`)}),e.jsxs("group",{position:[0,0,-70],children:[e.jsxs("mesh",{position:[0,3,0],castShadow:!0,receiveShadow:!0,children:[e.jsx("boxGeometry",{args:[40,6,10]}),e.jsx("meshStandardMaterial",{color:"#4169E1"})]}),Array.from({length:30}).map((r,o)=>e.jsxs("mesh",{position:[-18+o*1.2,6.5,-3+o%3*1],children:[e.jsx("sphereGeometry",{args:[.3,8,8]}),e.jsx("meshStandardMaterial",{color:["#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF"][o%5]})]},`spectator-${o}`))]}),Array.from({length:15}).map((r,o)=>{const a=(Math.random()-.5)*400,i=30+Math.random()*30,c=(Math.random()-.5)*400;return e.jsxs("group",{position:[a,i,c],children:[e.jsxs("mesh",{children:[e.jsx("sphereGeometry",{args:[5+Math.random()*3,8,8]}),e.jsx("meshStandardMaterial",{color:"#FFFFFF",transparent:!0,opacity:.9})]}),e.jsxs("mesh",{position:[4,-1,0],children:[e.jsx("sphereGeometry",{args:[3+Math.random()*2,8,8]}),e.jsx("meshStandardMaterial",{color:"#FFFFFF",transparent:!0,opacity:.9})]}),e.jsxs("mesh",{position:[-4,-1,0],children:[e.jsx("sphereGeometry",{args:[3+Math.random()*2,8,8]}),e.jsx("meshStandardMaterial",{color:"#FFFFFF",transparent:!0,opacity:.9})]})]},`cloud-${o}`)}),e.jsx("ambientLight",{intensity:.6}),e.jsx("directionalLight",{position:[50,100,50],intensity:1,castShadow:!0,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048,"shadow-camera-far":500,"shadow-camera-left":-200,"shadow-camera-right":200,"shadow-camera-top":200,"shadow-camera-bottom":-200}),e.jsx("color",{attach:"background",args:["#87CEEB"]})]})},se={first:{banana:.35,missile:0,shield:0,boost:.3,thunder:0,oil:.2,banana3:.1,goldBoost:.05},early:{banana:.25,missile:.1,shield:.1,boost:.25,thunder:0,oil:.15,banana3:.1,goldBoost:.05},middle:{banana:.15,missile:.2,shield:.15,boost:.2,thunder:.05,oil:.1,banana3:.1,goldBoost:.05},last:{banana:.05,missile:.25,shield:.2,boost:.15,thunder:.15,oil:.05,banana3:.05,goldBoost:.1}},Z={DRIFT_MIN_SPEED:50,DRIFT_LEVEL_2_TIME:1,DRIFT_LEVEL_3_TIME:2,DRIFT_BOOST_DURATION:1.5,TRANSFORM_COOLDOWN:5,MISSILE_SPEED:80},At={banana:{type:"banana",special:"place_trap"},missile:{type:"missile",damage:1,special:"homing_projectile"},shield:{type:"shield",duration:8,special:"invincible"},boost:{type:"boost",boost:1.5,duration:3},thunder:{type:"thunder",special:"shrink_all",duration:5},oil:{type:"oil",special:"place_oil"},banana3:{type:"banana3",special:"place_triple_banana"},goldBoost:{type:"goldBoost",boost:2,duration:5,special:"invincible"}},Tt=()=>{const s=p.useCallback((o,a)=>{let i;o===1?i=se.first:o<=Math.ceil(a/3)?i=se.early:o<=Math.ceil(a*2/3)?i=se.middle:i=se.last;const c=Math.random();let l=0;for(const[u,h]of Object.entries(i))if(l+=h,c<=l)return u;return"banana"},[]),n=p.useCallback((o,a,i)=>{if(!o.currentItem)return{machineUpdates:{}};const c=At[o.currentItem],l={currentItem:null},u=[];let h=[...i];switch(c.special){case"place_trap":{const d=o.position.clone(),m=new x(0,0,-3).applyEuler(o.rotation);d.add(m),d.y=.5,h.push({id:`banana-${Date.now()}`,type:"banana",position:d,rotation:new $(0,Math.random()*Math.PI*2,0),ownerId:o.id,createdAt:Date.now()});break}case"place_triple_banana":{for(let d=0;d<3;d++){const m=new x((d-1)*2,0,-3-d*2);m.applyEuler(o.rotation);const g=o.position.clone().add(m);g.y=.5,h.push({id:`banana-triple-${Date.now()}-${d}`,type:"banana",position:g,rotation:new $(0,Math.random()*Math.PI*2,0),ownerId:o.id,createdAt:Date.now()})}break}case"place_oil":{const d=o.position.clone(),m=new x(0,0,-4).applyEuler(o.rotation);d.add(m),d.y=.1,h.push({id:`oil-${Date.now()}`,type:"oil",position:d,rotation:new $(-Math.PI/2,0,0),ownerId:o.id,createdAt:Date.now()});break}case"homing_projectile":{const d=a.filter(m=>m.id!==o.id&&m.currentPosition<o.currentPosition).sort((m,g)=>m.currentPosition-g.currentPosition)[0];d&&h.push({id:`missile-${Date.now()}`,type:"missile",position:o.position.clone().add(new x(0,1,2)),rotation:o.rotation.clone(),ownerId:o.id,createdAt:Date.now(),targetId:d.id});break}case"invincible":{l.isInvincible=!0,l.invincibleEndTime=Date.now()+(c.duration||5)*1e3,c.boost&&(l.isBoosting=!0,l.boostEndTime=Date.now()+(c.duration||3)*1e3);break}case"shrink_all":{a.forEach(d=>{d.id!==o.id&&u.push({id:d.id,updates:{isSpinning:!0,speed:d.speed*.5}})});break}default:{c.boost&&(l.isBoosting=!0,l.boostEndTime=Date.now()+(c.duration||3)*1e3);break}}return{machineUpdates:l,newPlacedItems:h,affectedMachines:u}},[]),t=p.useCallback((o,a)=>{for(const c of a){if(c.ownerId===o.id&&Date.now()-c.createdAt<1e3)continue;if(c.type==="missile"){if(c.targetId===o.id&&o.position.distanceTo(c.position)<1.5*2)return{hitItem:c,effects:{isSpinning:!0,speed:0}};continue}if(o.position.distanceTo(c.position)<1.5){if(o.isInvincible)return{hitItem:c,effects:{}};switch(c.type){case"banana":return{hitItem:c,effects:{isSpinning:!0,speed:o.speed*.3}};case"oil":return{hitItem:c,effects:{isSpinning:!0,speed:o.speed*.5}};default:return{hitItem:c,effects:{}}}}}return{hitItem:null,effects:{}}},[]),r=p.useCallback((o,a,i)=>o.map(c=>{if(c.type==="missile"&&c.targetId){const l=a.find(u=>u.id===c.targetId);if(l){const u=new x().subVectors(l.position,c.position).normalize(),h=c.position.clone();h.add(u.multiplyScalar(Z.MISSILE_SPEED*i));const d=Math.atan2(u.x,u.z),m=new $(0,d,0);return{...c,position:h,rotation:m}}}return c}).filter(c=>{const l=Date.now()-c.createdAt;return c.type==="missile"?l<1e4:l<3e4}),[]);return{getRandomItem:s,useItem:n,checkPlacedItemCollision:t,updatePlacedItems:r}},It={banana:{color:"#FFD700",icon:"ğŸŒ"},missile:{color:"#FF0000",icon:"ğŸš€"},shield:{color:"#00BFFF",icon:"ğŸ›¡ï¸"},boost:{color:"#FF4500",icon:"ğŸ„"},thunder:{color:"#FFFF00",icon:"âš¡"},oil:{color:"#1a1a1a",icon:"ğŸ›¢ï¸"},banana3:{color:"#FFD700",icon:"ğŸŒğŸŒğŸŒ"},goldBoost:{color:"#FFD700",icon:"â­"}},Et=({playerMachine:s,allMachines:n,courseData:t,raceTime:r,countdown:o,gameState:a})=>{const i=l=>{const u=Math.floor(l/6e4),h=Math.floor(l%6e4/1e3),d=Math.floor(l%1e3/10);return`${u}:${h.toString().padStart(2,"0")}.${d.toString().padStart(2,"0")}`},c=l=>l===1?"st":l===2?"nd":l===3?"rd":"th";return e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"none",fontFamily:'"Press Start 2P", monospace'},children:[a==="countdown"&&e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"120px",color:o>0?"#FF0000":"#00FF00",textShadow:"0 0 20px rgba(0, 0, 0, 0.8)",animation:"pulse 1s ease-in-out infinite"},children:o>0?o:"GO!"}),e.jsxs("div",{style:{position:"absolute",top:"20px",left:"20px",padding:"15px 25px",background:"linear-gradient(135deg, rgba(0, 0, 0, 0.8), rgba(30, 30, 30, 0.8))",borderRadius:"10px",border:"3px solid #FFD700"},children:[e.jsxs("div",{style:{fontSize:"48px",color:"#FFD700",textShadow:"2px 2px 4px rgba(0, 0, 0, 0.5)"},children:[s.currentPosition,e.jsx("span",{style:{fontSize:"24px"},children:c(s.currentPosition)})]}),e.jsxs("div",{style:{fontSize:"14px",color:"#FFFFFF",marginTop:"5px"},children:["/ ",n.length]})]}),e.jsxs("div",{style:{position:"absolute",top:"20px",right:"20px",padding:"15px 25px",background:"linear-gradient(135deg, rgba(0, 0, 0, 0.8), rgba(30, 30, 30, 0.8))",borderRadius:"10px",border:"3px solid #00BFFF"},children:[e.jsx("div",{style:{fontSize:"14px",color:"#AAAAAA"},children:"LAP"}),e.jsxs("div",{style:{fontSize:"32px",color:"#00BFFF",textShadow:"2px 2px 4px rgba(0, 0, 0, 0.5)"},children:[Math.min(s.currentLap+1,t.laps),"/",t.laps]})]}),e.jsxs("div",{style:{position:"absolute",top:"20px",left:"50%",transform:"translateX(-50%)",padding:"10px 20px",background:"rgba(0, 0, 0, 0.7)",borderRadius:"5px"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#AAAAAA",textAlign:"center"},children:"TIME"}),e.jsx("div",{style:{fontSize:"24px",color:"#FFFFFF"},children:i(r)})]}),e.jsxs("div",{style:{position:"absolute",bottom:"120px",right:"20px",width:"150px",height:"150px",background:"radial-gradient(circle, rgba(0, 0, 0, 0.9), rgba(30, 30, 30, 0.8))",borderRadius:"50%",border:"4px solid #FF4500",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("div",{style:{fontSize:"32px",color:"#FF4500",textShadow:"2px 2px 4px rgba(0, 0, 0, 0.5)"},children:Math.round(s.speed*10)}),e.jsx("div",{style:{fontSize:"12px",color:"#AAAAAA"},children:"km/h"})]}),e.jsx("div",{style:{position:"absolute",bottom:"120px",left:"20px",width:"100px",height:"100px",background:"rgba(0, 0, 0, 0.8)",borderRadius:"15px",border:"4px solid #FFD700",display:"flex",alignItems:"center",justifyContent:"center"},children:s.currentItem?e.jsx("div",{style:{fontSize:"48px",animation:"bounce 0.5s ease-in-out infinite"},children:It[s.currentItem].icon}):e.jsx("div",{style:{fontSize:"16px",color:"#666666"},children:"NO ITEM"})}),e.jsx("div",{style:{position:"absolute",bottom:"290px",right:"20px",width:"180px",height:"120px",background:"rgba(0, 0, 0, 0.7)",borderRadius:"10px",border:"2px solid #FFFFFF",overflow:"hidden"},children:e.jsxs("svg",{viewBox:"-100 -70 200 140",style:{width:"100%",height:"100%"},children:[e.jsx("ellipse",{cx:"0",cy:"0",rx:"80",ry:"50",fill:"none",stroke:"#404040",strokeWidth:"8"}),n.map(l=>{const u=l.position.x/80*80,h=l.position.z/50*50,d=l.id===s.id;return e.jsx("circle",{cx:u,cy:h,r:d?6:4,fill:d?"#00FF00":l.color,stroke:d?"#FFFFFF":"none",strokeWidth:"2"},l.id)})]})}),e.jsxs("div",{style:{position:"absolute",bottom:"20px",left:"50%",transform:"translateX(-50%)",padding:"10px 20px",background:s.currentForm==="long"?"rgba(255, 100, 0, 0.8)":"rgba(0, 100, 255, 0.8)",borderRadius:"20px",fontSize:"16px",color:"#FFFFFF"},children:[s.currentForm==="long"?"LONG FORM":"NORMAL FORM",s.transformCooldown>0&&e.jsxs("span",{style:{marginLeft:"10px",opacity:.7},children:["(",Math.ceil(s.transformCooldown),"s)"]})]}),(s.isBoosting||s.isDrifting)&&e.jsx("div",{style:{position:"absolute",bottom:"60px",left:"50%",transform:"translateX(-50%)",padding:"5px 15px",background:s.isBoosting?"#FF4500":"#00BFFF",borderRadius:"15px",fontSize:"14px",color:"#FFFFFF",animation:"pulse 0.3s ease-in-out infinite"},children:s.isBoosting?"BOOST!":`DRIFT LV.${s.driftLevel}`}),e.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% { transform: translateX(-50%) scale(1); }
          50% { transform: translateX(-50%) scale(1.1); }
        }
        @keyframes bounce {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-5px); }
        }
      `})]})},Ct=({onSelectCup:s,unlockedCups:n,onBack:t})=>{const r=[{type:"monkey",name:"ãƒ¢ãƒ³ã‚­ãƒ¼ã‚«ãƒƒãƒ—",color:"#FFD700",icon:"ğŸµ"},{type:"banana",name:"ãƒãƒŠãƒŠã‚«ãƒƒãƒ—",color:"#FFFF00",icon:"ğŸŒ"},{type:"star",name:"ã‚¹ã‚¿ãƒ¼ã‚«ãƒƒãƒ—",color:"#00BFFF",icon:"â­"},{type:"special",name:"ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚«ãƒƒãƒ—",color:"#FF00FF",icon:"ğŸ‘‘"}];return e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(180deg, #1a1a4a 0%, #0a0a2a 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontFamily:'"Press Start 2P", monospace'},children:[e.jsx("h1",{style:{fontSize:"36px",color:"#FFD700",textShadow:"3px 3px 6px rgba(0, 0, 0, 0.8)",marginBottom:"40px"},children:"ğŸ† ã‚«ãƒƒãƒ—é¸æŠ ğŸ†"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"20px",maxWidth:"600px"},children:r.map(o=>{const a=n.includes(o.type);return e.jsxs("button",{onClick:()=>a&&s(o.type),disabled:!a,style:{width:"250px",height:"120px",background:a?`linear-gradient(135deg, ${o.color}40, ${o.color}20)`:"rgba(50, 50, 50, 0.8)",border:`4px solid ${a?o.color:"#333333"}`,borderRadius:"15px",cursor:a?"pointer":"not-allowed",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",transition:"transform 0.2s, box-shadow 0.2s",opacity:a?1:.5},onMouseEnter:i=>{a&&(i.currentTarget.style.transform="scale(1.05)",i.currentTarget.style.boxShadow=`0 0 20px ${o.color}`)},onMouseLeave:i=>{i.currentTarget.style.transform="scale(1)",i.currentTarget.style.boxShadow="none"},children:[e.jsx("div",{style:{fontSize:"40px",marginBottom:"10px"},children:a?o.icon:"ğŸ”’"}),e.jsx("div",{style:{fontSize:"14px",color:a?"#FFFFFF":"#666666"},children:o.name}),!a&&e.jsx("div",{style:{fontSize:"10px",color:"#FF0000",marginTop:"5px"},children:"å‰ã®ã‚«ãƒƒãƒ—ã‚’ã‚¯ãƒªã‚¢"})]},o.type)})}),e.jsx("button",{onClick:t,style:{marginTop:"40px",padding:"15px 40px",background:"rgba(100, 100, 100, 0.8)",border:"3px solid #FFFFFF",borderRadius:"10px",color:"#FFFFFF",fontSize:"16px",cursor:"pointer",fontFamily:"inherit"},children:"â† ã‚‚ã©ã‚‹"})]})},Rt=({rankings:s,playerMachine:n,raceTime:t,onNext:r,onRetry:o,isLastRace:a})=>{const i=u=>{const h=Math.floor(u/6e4),d=Math.floor(u%6e4/1e3),m=Math.floor(u%1e3/10);return`${h}:${d.toString().padStart(2,"0")}.${m.toString().padStart(2,"0")}`},c=s.findIndex(u=>u.id===n.id)+1,l=Math.max(0,7-c)*10;return e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.9)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontFamily:'"Press Start 2P", monospace'},children:[e.jsx("h1",{style:{fontSize:"48px",color:c<=3?"#FFD700":"#FFFFFF",textShadow:"3px 3px 6px rgba(0, 0, 0, 0.8)",marginBottom:"30px"},children:c===1?"ğŸ† 1ST PLACE! ğŸ†":c===2?"ğŸ¥ˆ 2ND PLACE! ğŸ¥ˆ":c===3?"ğŸ¥‰ 3RD PLACE! ğŸ¥‰":`${c}TH PLACE`}),e.jsxs("div",{style:{fontSize:"24px",color:"#FFFFFF",marginBottom:"20px"},children:["TIME: ",i(t)]}),e.jsxs("div",{style:{fontSize:"20px",color:"#FFD700",marginBottom:"30px"},children:["+",l," ã‚³ã‚¤ãƒ³ç²å¾—ï¼"]}),e.jsx("div",{style:{background:"rgba(30, 30, 30, 0.9)",borderRadius:"15px",padding:"20px",marginBottom:"30px",minWidth:"400px"},children:s.slice(0,6).map((u,h)=>{const d=u.id===n.id;return e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"10px 15px",background:d?"rgba(0, 255, 0, 0.2)":"transparent",borderRadius:"8px",marginBottom:"5px"},children:[e.jsxs("span",{style:{width:"40px",fontSize:"20px",color:h===0?"#FFD700":h===1?"#C0C0C0":h===2?"#CD7F32":"#FFFFFF"},children:[h+1,"."]}),e.jsx("span",{style:{width:"30px",height:"30px",borderRadius:"50%",background:u.color,marginRight:"15px"}}),e.jsx("span",{style:{flex:1,color:d?"#00FF00":"#FFFFFF",fontSize:"14px"},children:u.name})]},u.id)})}),e.jsxs("div",{style:{display:"flex",gap:"20px"},children:[e.jsx("button",{onClick:o,style:{padding:"15px 30px",background:"rgba(255, 100, 100, 0.8)",border:"3px solid #FF0000",borderRadius:"10px",color:"#FFFFFF",fontSize:"16px",cursor:"pointer",fontFamily:"inherit"},children:"ãƒªãƒˆãƒ©ã‚¤"}),e.jsx("button",{onClick:r,style:{padding:"15px 30px",background:"rgba(100, 255, 100, 0.8)",border:"3px solid #00FF00",borderRadius:"10px",color:"#FFFFFF",fontSize:"16px",cursor:"pointer",fontFamily:"inherit"},children:a?"ã‚«ãƒƒãƒ—çµæœã¸":"æ¬¡ã®ãƒ¬ãƒ¼ã‚¹ã¸ â†’"})]})]})},Pt=({onInput:s})=>{const[n,t]=V.useState({accelerate:!1,brake:!1,left:!1,right:!1,drift:!1,useItem:!1,transform:!1}),r=(o,a)=>{const i={...n,[o]:a};t(i),s(i)};return e.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:"200px",pointerEvents:"auto"},children:[e.jsxs("div",{style:{position:"absolute",left:"20px",bottom:"20px",display:"flex",gap:"10px"},children:[e.jsx("button",{onTouchStart:()=>r("left",!0),onTouchEnd:()=>r("left",!1),onMouseDown:()=>r("left",!0),onMouseUp:()=>r("left",!1),style:{width:"80px",height:"80px",borderRadius:"50%",background:n.left?"#00BFFF":"rgba(0, 0, 0, 0.6)",border:"3px solid #FFFFFF",fontSize:"30px",color:"#FFFFFF",cursor:"pointer"},children:"â—€"}),e.jsx("button",{onTouchStart:()=>r("right",!0),onTouchEnd:()=>r("right",!1),onMouseDown:()=>r("right",!0),onMouseUp:()=>r("right",!1),style:{width:"80px",height:"80px",borderRadius:"50%",background:n.right?"#00BFFF":"rgba(0, 0, 0, 0.6)",border:"3px solid #FFFFFF",fontSize:"30px",color:"#FFFFFF",cursor:"pointer"},children:"â–¶"})]}),e.jsxs("div",{style:{position:"absolute",right:"20px",bottom:"20px",display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"10px"},children:[e.jsx("button",{onTouchStart:()=>r("accelerate",!0),onTouchEnd:()=>r("accelerate",!1),onMouseDown:()=>r("accelerate",!0),onMouseUp:()=>r("accelerate",!1),style:{width:"70px",height:"70px",borderRadius:"50%",background:n.accelerate?"#00FF00":"rgba(0, 100, 0, 0.6)",border:"3px solid #00FF00",fontSize:"14px",color:"#FFFFFF",cursor:"pointer"},children:"GAS"}),e.jsx("button",{onTouchStart:()=>r("drift",!0),onTouchEnd:()=>r("drift",!1),onMouseDown:()=>r("drift",!0),onMouseUp:()=>r("drift",!1),style:{width:"70px",height:"70px",borderRadius:"50%",background:n.drift?"#FF4500":"rgba(100, 50, 0, 0.6)",border:"3px solid #FF4500",fontSize:"12px",color:"#FFFFFF",cursor:"pointer"},children:"DRIFT"}),e.jsx("button",{onTouchStart:()=>{r("useItem",!0),setTimeout(()=>r("useItem",!1),100)},style:{width:"70px",height:"70px",borderRadius:"50%",background:"rgba(100, 100, 0, 0.6)",border:"3px solid #FFD700",fontSize:"12px",color:"#FFFFFF",cursor:"pointer"},children:"ITEM"}),e.jsx("button",{onTouchStart:()=>{r("transform",!0),setTimeout(()=>r("transform",!1),100)},style:{width:"70px",height:"70px",borderRadius:"50%",background:"rgba(100, 0, 100, 0.6)",border:"3px solid #FF00FF",fontSize:"10px",color:"#FFFFFF",cursor:"pointer"},children:"FORM"})]})]})},ge="monkey-racer-save",Dt=()=>({coins:0,unlockedMachines:["heroMonkey"],unlockedParts:["engine_normal","tire_standard","handle_normal","body_light"],unlockedCups:["monkey"],cupProgress:{monkey:{completed:!1,bestRank:null},banana:{completed:!1,bestRank:null},star:{completed:!1,bestRank:null},special:{completed:!1,bestRank:null}},bestTimes:{},customization:{engine:"engine_normal",tire:"tire_standard",handle:"handle_normal",body:"body_light"}}),Gt=()=>({accelerate:!1,brake:!1,left:!1,right:!1,drift:!1,useItem:!1,transform:!1,pause:!1}),pe=()=>{try{const s=localStorage.getItem(ge);if(s)return JSON.parse(s)}catch(s){console.error("Failed to load racing save data:",s)}return Dt()},Bt=s=>{try{localStorage.setItem(ge,JSON.stringify(s))}catch(n){console.error("Failed to save racing data:",n)}},A=he((s,n)=>({gameState:"menu",setGameState:t=>s({gameState:t}),currentCup:null,setCurrentCup:t=>s({currentCup:t}),currentCourse:0,setCurrentCourse:t=>s({currentCourse:t}),playerMachine:null,setPlayerMachine:t=>s({playerMachine:t}),updatePlayerMachine:t=>s(r=>({playerMachine:r.playerMachine?{...r.playerMachine,...t}:null})),aiMachines:[],setAIMachines:t=>s({aiMachines:t}),updateAIMachine:(t,r)=>s(o=>({aiMachines:o.aiMachines.map(a=>a.id===t?{...a,...r}:a)})),placedItems:[],setPlacedItems:t=>s({placedItems:t}),addPlacedItem:t=>s(r=>({placedItems:[...r.placedItems,t]})),removePlacedItem:t=>s(r=>({placedItems:r.placedItems.filter(o=>o.id!==t)})),raceTime:0,setRaceTime:t=>s({raceTime:t}),countdown:3,setCountdown:t=>{s(typeof t=="function"?r=>({countdown:t(r.countdown)}):{countdown:t})},raceResults:[],setRaceResults:t=>s({raceResults:t}),saveData:pe(),updateSaveData:t=>{const r={...n().saveData,...t};Bt(r),s({saveData:r})},loadSaveData:()=>{const t=pe();s({saveData:t})},input:Gt(),setInput:t=>s(r=>({input:{...r.input,...t}})),updateInput:t=>s(r=>({input:{...r.input,...t}}))})),Nt=(s="heroMonkey")=>{const n={heroMonkey:{maxSpeed:100,acceleration:80,handling:80,weight:50,driftBonus:1},speedStar:{maxSpeed:120,acceleration:70,handling:60,weight:40,driftBonus:.8},tankMonkey:{maxSpeed:80,acceleration:60,handling:70,weight:90,driftBonus:1.2},ninjaMonkey:{maxSpeed:90,acceleration:90,handling:100,weight:30,driftBonus:1.5}},t={heroMonkey:"#4169E1",speedStar:"#DC143C",tankMonkey:"#708090",ninjaMonkey:"#1a1a1a"};return{id:"player",type:s,name:{heroMonkey:"ãƒ’ãƒ¼ãƒ­ãƒ¼ãƒ¢ãƒ³ã‚­ãƒ¼",speedStar:"ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¹ã‚¿ãƒ¼",tankMonkey:"ã‚¿ãƒ³ã‚¯ãƒ¢ãƒ³ã‚­ãƒ¼",ninjaMonkey:"ãƒ‹ãƒ³ã‚¸ãƒ£ãƒ¢ãƒ³ã‚­ãƒ¼"}[s],color:t[s],position:new x(0,0,0),rotation:new $(0,0,0),velocity:new x(0,0,0),speed:0,currentForm:"normal",stats:n[s],currentLap:0,lapTimes:[],currentCheckpoint:0,totalDistance:0,currentPosition:1,currentItem:null,isSpinning:!1,spinTime:0,isInvincible:!1,invincibleTime:0,isSlowed:!1,slowedTime:0,isBoosting:!1,boostTime:0,isDrifting:!1,driftTime:0,driftLevel:0,driftDirection:null,transformCooldown:0,isAI:!1,aiDifficulty:"normal",targetWaypoint:0}},Lt=(s,n)=>{const t={pipotronYellow:{maxSpeed:95,acceleration:75,handling:75,weight:50,driftBonus:1},pipotronBlue:{maxSpeed:110,acceleration:85,handling:65,weight:45,driftBonus:.9},pipotronRed:{maxSpeed:100,acceleration:90,handling:70,weight:55,driftBonus:1.1},pipotronBlack:{maxSpeed:115,acceleration:95,handling:90,weight:50,driftBonus:1.3},devichMonkey:{maxSpeed:85,acceleration:70,handling:80,weight:45,driftBonus:1},apeSoldier:{maxSpeed:90,acceleration:80,handling:75,weight:55,driftBonus:.9},bananaBoy:{maxSpeed:80,acceleration:65,handling:85,weight:40,driftBonus:1.1}},r={pipotronYellow:"#FFD700",pipotronBlue:"#4169E1",pipotronRed:"#DC143C",pipotronBlack:"#1a1a1a",devichMonkey:"#800080",apeSoldier:"#228B22",bananaBoy:"#FFA500"},o={pipotronYellow:"ãƒ”ãƒãƒˆãƒ­ãƒ³ãƒ»ã‚¤ã‚¨ãƒ­ãƒ¼",pipotronBlue:"ãƒ”ãƒãƒˆãƒ­ãƒ³ãƒ»ãƒ–ãƒ«ãƒ¼",pipotronRed:"ãƒ”ãƒãƒˆãƒ­ãƒ³ãƒ»ãƒ¬ãƒƒãƒ‰",pipotronBlack:"ãƒ”ãƒãƒˆãƒ­ãƒ³ãƒ»ãƒ–ãƒ©ãƒƒã‚¯",devichMonkey:"ãƒ‡ãƒ“ãƒƒãƒãƒ¢ãƒ³ã‚­ãƒ¼",apeSoldier:"ã‚¨ã‚¤ãƒ—ã‚½ãƒ«ã‚¸ãƒ£ãƒ¼",bananaBoy:"ãƒãƒŠãƒŠãƒœãƒ¼ã‚¤"};return{id:`ai_${s}_${n}`,type:s,name:o[s],color:r[s],position:new x(0,0,0),rotation:new $(0,0,0),velocity:new x(0,0,0),speed:0,currentForm:"normal",stats:t[s],currentLap:0,lapTimes:[],currentCheckpoint:0,totalDistance:0,currentPosition:n+2,currentItem:null,isSpinning:!1,spinTime:0,isInvincible:!1,invincibleTime:0,isSlowed:!1,slowedTime:0,isBoosting:!1,boostTime:0,isDrifting:!1,driftTime:0,driftLevel:0,driftDirection:null,transformCooldown:0,isAI:!0,aiDifficulty:"normal",targetWaypoint:0}},zt=s=>({forward:s.accelerate,backward:s.brake,left:s.left,right:s.right,drift:s.drift,item:s.useItem,transform:s.transform}),_t=()=>({updateMachinePhysics:p.useCallback((n,t,r,o)=>{const a="accelerate"in t?zt(t):t,i={},c=n.stats;let l=0;a.forward?(l=c.maxSpeed,n.isBoosting&&(l*=1.5)):a.backward&&(l=-c.maxSpeed*.3);const u=a.forward?c.acceleration:c.acceleration*2;let h=ee.lerp(n.speed,l,u*o),d=n.isDrifting,m=n.driftDirection,g=n.driftLevel,f=n.driftTime;a.drift&&n.speed>Z.DRIFT_MIN_SPEED?n.isDrifting?(f=(n.driftTime||0)+o,f>Z.DRIFT_LEVEL_3_TIME?g=3:f>Z.DRIFT_LEVEL_2_TIME&&(g=2)):(d=!0,m=a.left?"left":a.right?"right":null,g=1,f=0):n.isDrifting&&!a.drift&&(d=!1,n.driftLevel>=1&&(i.isBoosting=!0,i.boostEndTime=Date.now()+Z.DRIFT_BOOST_DURATION*n.driftLevel*1e3),m=null,g=0,f=0);let S=0;a.left&&(S=1),a.right&&(S=-1);const L=(d?c.handling*.7:c.handling)*o*(h/c.maxSpeed),v=n.rotation.clone();if(v.y+=S*L,d&&m){const B=m==="left"?.5:-.5;v.y+=B*o}const Y=new x(0,0,1);Y.applyEuler(v);const U=n.position.clone();U.add(Y.multiplyScalar(h*o));const z=150;U.length()>z&&(U.setLength(z),h*=.5),U.y=0;let M=n.currentForm;a.transform&&n.transformCooldown<=0&&(M=n.currentForm==="normal"?"long":"normal",i.transformCooldown=Z.TRANSFORM_COOLDOWN);let H=n.transformCooldown-o;return H<0&&(H=0),n.isBoosting&&n.boostEndTime&&Date.now()>n.boostEndTime&&(i.isBoosting=!1,i.boostEndTime=void 0),n.isSpinning&&(i.isSpinning=!1),n.isInvincible&&n.invincibleEndTime&&Date.now()>n.invincibleEndTime&&(i.isInvincible=!1,i.invincibleEndTime=void 0),{...i,position:U,rotation:v,speed:h,isDrifting:d,driftDirection:m,driftLevel:g,driftTime:f,currentForm:M,transformCooldown:H}},[])}),Ot=()=>{const s=p.useRef(new Map);return{updateAI:p.useCallback((t,r,o,a)=>{let i=s.current.get(t.id)||0;const c=r.waypoints[i],l=new x().subVectors(c,t.position);l.length()<10&&(i=(i+1)%r.waypoints.length,s.current.set(t.id,i));const h=new x(0,0,1).applyEuler(t.rotation);l.normalize();const d=h.cross(l),m=new x(0,0,1).applyEuler(t.rotation).dot(l),g=.1,f=d.y<-g,S=d.y>g,E=m>-.3,L=m<-.7,v=Math.abs(d.y)>.5&&t.speed>Z.DRIFT_MIN_SPEED*.8;let Y=!1;t.currentItem&&o.filter(M=>M.id!==t.id&&M.currentPosition<t.currentPosition).length>0&&Math.random()<.02&&(Y=!0);const U=Math.abs(d.y)<.1&&t.currentForm==="normal"&&Math.random()<.001;return{forward:E,backward:L,left:f,right:S,drift:v,item:Y,transform:U}},[])}},Yt=()=>({updateProgress:p.useCallback((n,t)=>{const r={},o=n.currentCheckpoint;if(o>=t.checkpoints.length)return r;const a=t.checkpoints[o];if(n.position.distanceTo(a.position)<a.width&&(r.currentCheckpoint=o+1,o===t.checkpoints.length-1)){r.currentLap=n.currentLap+1,r.currentCheckpoint=0;const c=Date.now();if(n.lapTimes.length===0)r.lapTimes=[c];else{const l=n.lapTimes[n.lapTimes.length-1];r.lapTimes=[...n.lapTimes,c-l]}}return r},[])}),Ht=()=>{const s=p.useCallback((t,r)=>{for(const a of r){if(a.id===t.id)continue;if(t.position.distanceTo(a.position)<3){const c=new x().subVectors(t.position,a.position).normalize();return{collidedWith:a,pushDirection:c}}}return{collidedWith:null,pushDirection:new x}},[]),n=p.useCallback((t,r)=>{for(const a of r.itemBoxes){if(!a.isActive)continue;if(t.position.distanceTo(a.position)<2)return a.id}return null},[]);return{checkMachineCollisions:s,checkItemBoxCollision:n}},Ut=()=>({calculateRankings:p.useCallback((n,t)=>[...n].sort((r,o)=>{if(r.currentLap!==o.currentLap)return o.currentLap-r.currentLap;if(r.currentCheckpoint!==o.currentCheckpoint)return o.currentCheckpoint-r.currentCheckpoint;const a=t.checkpoints[r.currentCheckpoint%t.checkpoints.length],i=t.checkpoints[o.currentCheckpoint%t.checkpoints.length],c=r.position.distanceTo(a.position),l=o.position.distanceTo(i.position);return c-l}),[])}),$t=({target:s})=>{const{camera:n}=be(),t=p.useRef(new x(0,10,20)),r=p.useRef(new x);return K((o,a)=>{if(!s)return;const i=new x(0,8,-15);i.applyEuler(s.rotation);const c=s.position.clone().add(i);t.current.lerp(c,a*5),r.current.lerp(s.position,a*5),n.position.copy(t.current),n.lookAt(r.current)}),null},Kt=()=>{const s=A(t=>t.placedItems),n=p.useRef(0);return K(({clock:t})=>{n.current=t.getElapsedTime()}),e.jsx(e.Fragment,{children:s.map(t=>t.type==="banana"?e.jsx("group",{position:t.position,children:e.jsxs("mesh",{rotation:[0,n.current*2,Math.PI/6],children:[e.jsx("capsuleGeometry",{args:[.15,.5,4,8]}),e.jsx("meshStandardMaterial",{color:"#FFD700"})]})},t.id):t.type==="oil"?e.jsxs("mesh",{position:t.position,rotation:t.rotation,children:[e.jsx("circleGeometry",{args:[2,16]}),e.jsx("meshStandardMaterial",{color:"#1a1a1a",transparent:!0,opacity:.8})]},t.id):t.type==="missile"?e.jsxs("group",{position:t.position,rotation:t.rotation,children:[e.jsxs("mesh",{children:[e.jsx("coneGeometry",{args:[.3,1,8]}),e.jsx("meshStandardMaterial",{color:"#FF0000",emissive:"#FF4500",emissiveIntensity:.5})]}),e.jsxs("mesh",{position:[0,-.7,0],children:[e.jsx("coneGeometry",{args:[.2,.5,8]}),e.jsx("meshBasicMaterial",{color:"#FF4500",transparent:!0,opacity:.8})]})]},t.id):null)})},Wt=({courseData:s,onItemBoxCollected:n})=>{const t=A(M=>M.playerMachine),r=A(M=>M.aiMachines),o=A(M=>M.gameState),a=A(M=>M.input),i=A(M=>M.setPlayerMachine),c=A(M=>M.setAIMachines),l=A(M=>M.setPlacedItems),u=A(M=>M.setRaceTime),h=A(M=>M.placedItems),d=A(M=>M.raceTime),{updateMachinePhysics:m}=_t(),{updateAI:g}=Ot(),{updateProgress:f}=Yt(),{checkMachineCollisions:S,checkItemBoxCollision:E}=Ht(),{calculateRankings:L}=Ut(),{getRandomItem:v,checkPlacedItemCollision:Y,updatePlacedItems:U}=Tt(),z=t?[t,...r]:r;return K((M,H)=>{if(o!=="racing"||!t)return;u(d+H*1e3);const B=m(t,a,s,H),C=f(t,s),F=E(t,s);if(F&&!t.currentItem){n(F);const W=L(z,s).findIndex(X=>X.id===t.id)+1;B.currentItem=v(W,z.length)}const{hitItem:w,effects:b}=Y(t,h);w&&(l(h.filter(I=>I.id!==w.id)),Object.assign(B,b));const{collidedWith:T,pushDirection:N}=S(t,z);if(T){const I=t.position.clone().add(N.multiplyScalar(.5));B.position=I,B.speed=t.speed*.8}i({...t,...B,...C});const y=r.map(I=>{const W=g(I,s,z,H),X=m(I,W,s,H),oe=f(I,s),te=E(I,s);if(te&&!I.currentItem){n(te);const je=L(z,s).findIndex(Fe=>Fe.id===I.id)+1;X.currentItem=v(je,z.length)}const{hitItem:ae,effects:ye}=Y(I,h);return ae&&(l(h.filter(ie=>ie.id!==ae.id)),Object.assign(X,ye)),{...I,...X,...oe}});c(y);const k=U(h,z,H);k.length!==h.length&&l(k);const _=L([{...t,...B,...C},...y],s);_.forEach((I,W)=>{I.currentPosition=W+1});const J=_.find(I=>I.id===t.id);J&&i({...J}),c(_.filter(I=>I.id!==t.id))}),e.jsxs(e.Fragment,{children:[e.jsx(vt,{courseData:s}),t&&e.jsx(ue,{machine:t,isPlayer:!0}),r.map(M=>e.jsx(ue,{machine:M,isPlayer:!1},M.id)),e.jsx(Kt,{}),e.jsx($t,{target:t})]})},Xt=({onBack:s})=>{const n=A(y=>y.gameState),t=A(y=>y.setGameState),r=A(y=>y.setCurrentCup),o=A(y=>y.currentCourse),a=A(y=>y.setCurrentCourse),i=A(y=>y.playerMachine),c=A(y=>y.setPlayerMachine),l=A(y=>y.aiMachines),u=A(y=>y.setAIMachines),h=A(y=>y.countdown),d=A(y=>y.setCountdown),m=A(y=>y.raceTime),g=A(y=>y.setRaceTime),f=A(y=>y.setInput),S=A(y=>y.saveData),E=A(y=>y.loadSaveData),L=A(y=>y.setPlacedItems),[v,Y]=p.useState(null),[U,z]=p.useState(!1),[M,H]=p.useState(!1),B=p.useRef(null);p.useEffect(()=>{H("ontouchstart"in window||navigator.maxTouchPoints>0)},[]),p.useEffect(()=>{E()},[E]),p.useEffect(()=>{const y=_=>{switch(_.code){case"ArrowUp":case"KeyW":f({accelerate:!0});break;case"ArrowDown":case"KeyS":f({brake:!0});break;case"ArrowLeft":case"KeyA":f({left:!0});break;case"ArrowRight":case"KeyD":f({right:!0});break;case"Space":f({drift:!0});break;case"KeyX":f({useItem:!0});break;case"KeyZ":f({transform:!0});break}},k=_=>{switch(_.code){case"ArrowUp":case"KeyW":f({accelerate:!1});break;case"ArrowDown":case"KeyS":f({brake:!1});break;case"ArrowLeft":case"KeyA":f({left:!1});break;case"ArrowRight":case"KeyD":f({right:!1});break;case"Space":f({drift:!1});break;case"KeyX":f({useItem:!1});break;case"KeyZ":f({transform:!1});break}};return window.addEventListener("keydown",y),window.addEventListener("keyup",k),()=>{window.removeEventListener("keydown",y),window.removeEventListener("keyup",k)}},[f]);const C=p.useCallback(y=>{r(y),a(0),t("course-select"),F()},[r,a,t]),F=p.useCallback(()=>{const y=kt();Y(y);const k=Nt("heroMonkey");k.position.copy(y.startPosition),k.rotation.copy(y.startRotation),c(k);const J=["pipotronYellow","pipotronBlue","pipotronRed","pipotronBlack","devichMonkey"].map((I,W)=>{const X=Lt(I,W),oe=(W%2-.5)*4,te=-5-Math.floor(W/2)*4;return X.position.set(y.startPosition.x+oe,0,y.startPosition.z+te),X.rotation.copy(y.startRotation),X});u(J),L([]),t("countdown"),d(3),g(0),B.current&&clearInterval(B.current),B.current=window.setInterval(()=>{d(I=>I<=1?(clearInterval(B.current),t("racing"),0):I-1)},1e3)},[c,u,t,d,g,L]),w=p.useCallback(y=>{v&&(Y({...v,itemBoxes:v.itemBoxes.map(k=>k.id===y?{...k,isActive:!1}:k)}),setTimeout(()=>{Y(k=>k?{...k,itemBoxes:k.itemBoxes.map(_=>_.id===y?{..._,isActive:!0}:_)}:null)},1e4))},[v]);p.useEffect(()=>{n==="racing"&&i&&v&&i.currentLap>=v.laps&&(t("finished"),z(!0))},[n,i,v,t]);const b=p.useCallback(y=>{f(y)},[f]),T=p.useCallback(()=>{z(!1),F()},[F]),N=p.useCallback(()=>{z(!1),t("menu")},[t]);return p.useEffect(()=>()=>{B.current&&clearInterval(B.current)},[]),e.jsxs("div",{style:{width:"100vw",height:"100vh",overflow:"hidden"},children:[n==="menu"&&e.jsx(Ct,{onSelectCup:C,unlockedCups:S.unlockedCups,onBack:s}),(n==="countdown"||n==="racing"||n==="finished")&&v&&e.jsxs(e.Fragment,{children:[e.jsx(me,{shadows:!0,children:e.jsx(Wt,{courseData:v,onItemBoxCollected:w})}),i&&e.jsx(Et,{playerMachine:i,allMachines:[i,...l],courseData:v,raceTime:m,countdown:h,gameState:n}),M&&n==="racing"&&e.jsx(Pt,{onInput:b}),U&&i&&e.jsx(Rt,{rankings:[i,...l].sort((y,k)=>y.currentPosition-k.currentPosition),playerMachine:i,raceTime:m,onNext:N,onRetry:T,isLastRace:o>=3})]})]})},Vt=({onSelectMode:s})=>e.jsxs("div",{style:{width:"100vw",height:"100vh",background:"linear-gradient(180deg, #1a1a4a 0%, #4a1a4a 50%, #1a1a2a 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontFamily:'"Press Start 2P", monospace',overflow:"hidden"},children:[e.jsxs("div",{style:{marginBottom:"60px",textAlign:"center"},children:[e.jsx("h1",{style:{fontSize:"clamp(24px, 6vw, 48px)",color:"#FFD700",textShadow:"4px 4px 8px rgba(0, 0, 0, 0.8), 0 0 40px rgba(255, 215, 0, 0.5)",marginBottom:"10px",animation:"titleBounce 2s ease-in-out infinite"},children:"ğŸµ ãƒ¢ãƒ³ã‚­ãƒ¼GET! ğŸµ"}),e.jsx("p",{style:{fontSize:"clamp(12px, 3vw, 20px)",color:"#00BFFF",textShadow:"2px 2px 4px rgba(0, 0, 0, 0.6)"},children:"~ ãƒ¢ãƒ³ã‚­ãƒ¼ã‚¢ãƒ‰ãƒ™ãƒ³ãƒãƒ£ãƒ¼ ~"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px",width:"100%",maxWidth:"400px",padding:"0 20px"},children:[e.jsxs("button",{onClick:()=>s("action"),style:{padding:"25px 30px",background:"linear-gradient(135deg, rgba(255, 100, 50, 0.8), rgba(255, 50, 50, 0.6))",border:"4px solid #FF6B35",borderRadius:"20px",cursor:"pointer",transition:"all 0.3s",display:"flex",alignItems:"center",gap:"20px"},onMouseEnter:n=>{n.currentTarget.style.transform="scale(1.05)",n.currentTarget.style.boxShadow="0 0 30px rgba(255, 100, 50, 0.6)"},onMouseLeave:n=>{n.currentTarget.style.transform="scale(1)",n.currentTarget.style.boxShadow="none"},children:[e.jsx("span",{style:{fontSize:"48px"},children:"ğŸ¯"}),e.jsxs("div",{style:{textAlign:"left"},children:[e.jsx("div",{style:{fontSize:"clamp(14px, 4vw, 20px)",color:"#FFFFFF",fontFamily:"inherit",marginBottom:"5px"},children:"ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ¢ãƒ¼ãƒ‰"}),e.jsx("div",{style:{fontSize:"clamp(10px, 2.5vw, 12px)",color:"#FFCCCC",fontFamily:"inherit"},children:"ã‚µãƒ«ã‚’ã¤ã‹ã¾ãˆã‚ï¼"})]})]}),e.jsxs("button",{onClick:()=>s("racing"),style:{padding:"25px 30px",background:"linear-gradient(135deg, rgba(50, 150, 255, 0.8), rgba(50, 100, 200, 0.6))",border:"4px solid #00BFFF",borderRadius:"20px",cursor:"pointer",transition:"all 0.3s",display:"flex",alignItems:"center",gap:"20px"},onMouseEnter:n=>{n.currentTarget.style.transform="scale(1.05)",n.currentTarget.style.boxShadow="0 0 30px rgba(50, 150, 255, 0.6)"},onMouseLeave:n=>{n.currentTarget.style.transform="scale(1)",n.currentTarget.style.boxShadow="none"},children:[e.jsx("span",{style:{fontSize:"48px"},children:"ğŸï¸"}),e.jsxs("div",{style:{textAlign:"left"},children:[e.jsx("div",{style:{fontSize:"clamp(14px, 4vw, 20px)",color:"#FFFFFF",fontFamily:"inherit",marginBottom:"5px"},children:"ãƒ¬ãƒ¼ã‚¹ãƒ¢ãƒ¼ãƒ‰"}),e.jsx("div",{style:{fontSize:"clamp(10px, 2.5vw, 12px)",color:"#CCCCFF",fontFamily:"inherit"},children:"ãƒ¢ãƒ³ã‚­ãƒ¼ãƒ¬ãƒ¼ã‚µãƒ¼ï¼"})]})]})]}),e.jsx("div",{style:{position:"absolute",bottom:"20px",fontSize:"12px",color:"rgba(255, 255, 255, 0.5)"},children:"Â© 2026 ãƒ¢ãƒ³ã‚­ãƒ¼GET!"}),e.jsx("style",{children:`
        @keyframes titleBounce {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-10px); }
        }
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
      `})]});function Jt(){const[s,n]=p.useState("main-menu"),t=o=>{n(o)},r=()=>{n("main-menu")};return e.jsxs(e.Fragment,{children:[s==="main-menu"&&e.jsx(Vt,{onSelectMode:t}),s==="action"&&e.jsx(jt,{}),s==="racing"&&e.jsx(Xt,{onBack:r})]})}we.createRoot(document.getElementById("root")).render(e.jsx(V.StrictMode,{children:e.jsx(Jt,{})}));
